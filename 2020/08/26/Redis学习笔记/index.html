<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"light-alex.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":"default"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":true,"color":"#222","save":"manual"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="什么是NoSQLNoSQL &#x3D; Not Only SQL （不仅仅是SQL） 关系型数据库：表格，行，列 泛指非关系型数据库，随着web2.0互联网的诞生！传统的关系型数据库很难对付web2.0时代！尤其是超大规模的高并发的社区！暴露出很多难以克服的问题，NoSQL在当今大数据环境下发展十分迅速，Redis是发展最快的，是我们当下必须要掌握的技术！ 很多的数据类型用户的个人信息，社交网络，地理位置">
<meta property="og:type" content="article">
<meta property="og:title" content="Redis学习笔记">
<meta property="og:url" content="https://light-alex.github.io/2020/08/26/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Light">
<meta property="og:description" content="什么是NoSQLNoSQL &#x3D; Not Only SQL （不仅仅是SQL） 关系型数据库：表格，行，列 泛指非关系型数据库，随着web2.0互联网的诞生！传统的关系型数据库很难对付web2.0时代！尤其是超大规模的高并发的社区！暴露出很多难以克服的问题，NoSQL在当今大数据环境下发展十分迅速，Redis是发展最快的，是我们当下必须要掌握的技术！ 很多的数据类型用户的个人信息，社交网络，地理位置">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis%E6%94%AF%E6%8C%81%E7%9A%84%E8%AF%AD%E8%A8%80.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E4%BB%8B%E7%BB%8D.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E5%8E%8B%E7%BC%A9%E5%8C%85.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%8E%AF%E5%A2%83%E7%9B%AE%E5%BD%95.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E7%9B%AE%E5%BD%95.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%8F%8C%E5%87%BB%E8%BF%90%E8%A1%8Credis%E6%9C%8D%E5%8A%A1.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%89%93%E5%BC%80redis%E5%AE%A2%E6%88%B7%E7%AB%AF.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E7%AE%80%E4%BB%8B.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E7%AE%80%E4%BB%8B%E4%B8%AD%E6%96%87%E7%89%88.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/dockerhub.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E8%BF%90%E8%A1%8C%E9%95%9C%E5%83%8F.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E4%BF%A1%E6%81%AF.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E4%BF%AE%E6%94%B9sshd_config%E6%96%87%E4%BB%B6.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%B5%8B%E8%AF%95redis.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/benchmark%E5%8F%82%E6%95%B0.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E9%BB%98%E8%AE%A416%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/5%E5%A4%A7%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/6%E4%B8%AA%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%E5%91%BD%E4%BB%A4.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%B5%8B%E8%AF%95%E8%BF%9E%E6%8E%A5.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redisTemplate%E5%BA%8F%E5%88%97%E5%8C%96%E9%85%8D%E7%BD%AE.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JDK%E5%BA%8F%E5%88%97%E5%8C%96.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%AF%B9%E8%B1%A1%E7%9A%84%E4%BF%9D%E5%AD%98%E9%9C%80%E8%A6%81%E5%BA%8F%E5%88%97%E5%8C%96.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E7%9A%84%E5%8D%95%E4%BD%8D.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%BB%84%E5%90%88%E5%A4%9A%E4%B8%AAconf%E6%96%87%E4%BB%B6.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/rdb.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/rdb%E6%96%87%E4%BB%B6.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%9F%A5%E7%9C%8B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/aof.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/pubsub1.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/pubsub2.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E8%BF%9B%E7%A8%8B.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%88%90%E5%8A%9F.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%B1%82%E5%B1%82%E9%93%BE%E8%B7%AF.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%A4%9A%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%93%A8%E5%85%B5%E9%80%89%E7%9A%84%E6%96%B0%E4%B8%BB%E8%8A%82%E7%82%B9.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%93%A8%E5%85%B5%E6%97%A5%E5%BF%97.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%BC%93%E5%AD%98%E7%A9%BA%E5%AF%B9%E8%B1%A1.png">
<meta property="og:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9.png">
<meta property="article:published_time" content="2020-08-26T13:55:33.000Z">
<meta property="article:modified_time" content="2020-10-10T13:35:05.380Z">
<meta property="article:author" content="Light">
<meta property="article:tag" content="数据库">
<meta property="article:tag" content="Redis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://light-alex.github.io/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis%E6%94%AF%E6%8C%81%E7%9A%84%E8%AF%AD%E8%A8%80.png">

<link rel="canonical" href="https://light-alex.github.io/2020/08/26/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Redis学习笔记 | Light</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <a href="https://github.com/Light-Alex" target="_blank" rel="noopener" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Light</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">千里寒江雪</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://light-alex.github.io/2020/08/26/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/header.png">
      <meta itemprop="name" content="Light">
      <meta itemprop="description" content="个人博客">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Light">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Redis学习笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-08-26 21:55:33" itemprop="dateCreated datePublished" datetime="2020-08-26T21:55:33+08:00">2020-08-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-10-10 21:35:05" itemprop="dateModified" datetime="2020-10-10T21:35:05+08:00">2020-10-10</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/" itemprop="url" rel="index"><span itemprop="name">数据库</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>52k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>47 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="什么是NoSQL"><a href="#什么是NoSQL" class="headerlink" title="什么是NoSQL"></a>什么是NoSQL</h1><p>NoSQL = Not Only SQL （不仅仅是SQL）</p>
<p>关系型数据库：表格，行，列</p>
<p>泛指非关系型数据库，随着web2.0互联网的诞生！传统的关系型数据库很难对付web2.0时代！尤其是超大规模的高并发的社区！暴露出很多难以克服的问题，NoSQL在当今大数据环境下发展十分迅速，Redis是发展最快的，是我们当下必须要掌握的技术！</p>
<p>很多的数据类型用户的个人信息，社交网络，地理位置，这些数据类型的存储不需要一个固定的格式！不需要多余的操作就可以横向扩展！Map<String, Object> 使用键值对控制！</p>
<a id="more"></a>
<h1 id="NoSQL特点"><a href="#NoSQL特点" class="headerlink" title="NoSQL特点"></a>NoSQL特点</h1><p>解耦！</p>
<p>1、方便扩展（数据之间没有关系，很好扩展！）</p>
<p>2、大数据量高性能（Redis一秒写8万次，读取11万次，NoSQL的缓存，记录级，是一种细粒度的缓存，性能会比较高！）</p>
<p>3、数据类型是多样型的！（不需要事先设计数据库！随取随用！如果是数据库量十分大，就不好设计数据库了）</p>
<p>4、传统的RDBMS和NoSQL</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">传统的 RDBMS</span><br><span class="line">- 结构化组织</span><br><span class="line">- SQL</span><br><span class="line">- 数据和关系都存在单独的表中 row col</span><br><span class="line">- 数据操作，数据定义语言</span><br><span class="line">- 严格的一致性</span><br><span class="line">- 基础的事务</span><br><span class="line">- ......</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">NoSQL</span><br><span class="line">- 不仅仅是数据</span><br><span class="line">- 没有固定的查询语言</span><br><span class="line">- 键值对存储，列存储，文档存储，图形数据库（社交关系）</span><br><span class="line">- 最终一致性</span><br><span class="line">- CAP理论 和 BASE理论（异地多活）</span><br><span class="line">- 高性能、高可用、高可扩展性</span><br><span class="line">- ......</span><br></pre></td></tr></table></figure>
<blockquote>
<p>了解：3V+3高</p>
</blockquote>
<p>大数据时代的3V：主要是描述问题的</p>
<ol>
<li>海量Volume</li>
<li>多样Variety</li>
<li>实时Velocity</li>
</ol>
<p>大数据时代的3高：主要对程序的要求</p>
<ol>
<li>高并发</li>
<li>高可扩（随时水平拆分，机器不够了，可以扩展机器数量）</li>
<li>高性能（保证用户体验和性能！）</li>
</ol>
<p>在公司中实践：NoSQL + RDBMS</p>
<h1 id="数据存储"><a href="#数据存储" class="headerlink" title="数据存储"></a>数据存储</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1、商品的基本信息</span></span><br><span class="line">	名称、价格、商家信息</span><br><span class="line">	关系型数据库就可以解决！MySQL / Oracle （淘宝早年就去IOE了！-王坚：推荐文章：阿里云的这群疯子）</span><br><span class="line">	淘宝内部的MySQL不是大家用的MySQL</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2、商品的描述、评论（文字比较多）</span></span><br><span class="line">	文档型数据库中：MongoDB</span><br><span class="line">	</span><br><span class="line"><span class="comment"># 3、图片</span></span><br><span class="line">	分布式文件系统：FastDFS</span><br><span class="line">	- 淘宝       TFS</span><br><span class="line">	- Google的  GFS</span><br><span class="line">	- Hadoop    HDFS</span><br><span class="line">	- 阿里云     oss</span><br><span class="line">	</span><br><span class="line"><span class="comment"># 4、商品关键字（搜索）</span></span><br><span class="line">	- 搜索引擎 solr elasticsearch</span><br><span class="line">    - ISearch：多隆（阿里技术大佬）</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5、商品热门的波段信息</span></span><br><span class="line">	- 内存数据库</span><br><span class="line">	- Redis、Tair、Memcache...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 6、商品的交易，外部的支付接口</span></span><br><span class="line">	- 三方应用</span><br></pre></td></tr></table></figure>
<h1 id="NoSQL的四大分类"><a href="#NoSQL的四大分类" class="headerlink" title="NoSQL的四大分类"></a>NoSQL的四大分类</h1><p><strong>KV键值对：</strong></p>
<ul>
<li>新浪：Redis</li>
<li>美团：Redis + Tair</li>
<li>阿里、百度：Redis + memcache</li>
</ul>
<p><strong>文档型数据库（bson格式和json一样）：</strong></p>
<ul>
<li>MongoDB<ul>
<li>MongoDB是一个基于分布式文件存储的数据库，C++编写，主要用来处理大量的文档！</li>
<li>MongoDB是一个介于关系型数据库和非关系型数据库中间的产品！MongoDB是非关系型数据库中功能最丰富，最像关系型数据库的！</li>
</ul>
</li>
<li>ConthDB</li>
</ul>
<p><strong>列存储数据库：</strong></p>
<ul>
<li>HBase</li>
<li>分布式文件系统</li>
</ul>
<p><strong>图关系数据库：</strong></p>
<ul>
<li>他不是存图形的，放的是关系，比如：朋友圈社交网络，广告推荐！</li>
<li>Neo4j</li>
<li>InfoGrid</li>
</ul>
<p><strong>四者对比：</strong></p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">分类</th>
<th>Example举例</th>
<th>典型应用场景</th>
<th>数据模型</th>
<th>优点</th>
<th>缺点</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>键值（key-value）</strong></td>
<td>Tokyo Cabinet/Tyrant, Redis, Voldemort, Oracle BDB</td>
<td>内容缓存，主要用于处理大量数据的高访问负载，也用于一些日志系统等等。</td>
<td>Key指向Value的键值对，通常用hash table来实现</td>
<td>查找速度快</td>
<td>数据无结构化，通常只被当作字符串或者二进制数据</td>
</tr>
<tr>
<td style="text-align:left"><strong>列存储数据库</strong></td>
<td>Cassandra, HBase, Rlak</td>
<td>分布式文件系统</td>
<td>以列簇式存储，将同一列数据存在一起</td>
<td>查找速度快，可扩展性强，更容易进行分布式扩展</td>
<td>功能相对局限</td>
</tr>
<tr>
<td style="text-align:left"><strong>文档型数据库</strong></td>
<td>CouchDB, MongoDB</td>
<td>Web应用（与Key-Value类似，Value是结构化的，不同的是数据库能够了解的Value的内容）</td>
<td>Key-Value对应键值对，Value为结构化数据</td>
<td>数据结构要求严格，表结构可变，不需要像关系型数据库一样预先定义表结构</td>
<td>查询性能不高，而且缺乏统一的查询语法</td>
</tr>
<tr>
<td style="text-align:left"><strong>图形(Graph)数据库</strong></td>
<td>Neo4j, InfoGrid, Infinite Graph</td>
<td>社交网络，推荐系统等。专注于构建关系图谱</td>
<td>图结构</td>
<td>利用图结构相关算法。比如最短路径寻址，N度关系查找</td>
<td>很多时候需要对整个图做计算才能得出需要的信息，而且这种结构不太好做分布式的集群方案</td>
</tr>
</tbody>
</table>
</div>
<h1 id="Redis入门"><a href="#Redis入门" class="headerlink" title="Redis入门"></a>Redis入门</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><blockquote>
<p>Redis是什么？</p>
</blockquote>
<p>Redis（<strong>Re</strong>mote <strong>Di</strong>ctionary <strong>S</strong>erver )，即远程字典服务，是一个开源的使用ANSI <a href="https://baike.baidu.com/item/C语言" target="_blank" rel="noopener">C语言</a>编写、支持网络、可基于内存亦可持久化的日志型、Key-Value<a href="https://baike.baidu.com/item/数据库/103728" target="_blank" rel="noopener">数据库</a>，并提供多种语言的API。</p>
<p>redis会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了master-slave(主从)同步。</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Redis%E6%94%AF%E6%8C%81%E7%9A%84%E8%AF%AD%E8%A8%80.png" alt="Redis支持的语言"></p>
<blockquote>
<p>Redis能做什么？</p>
</blockquote>
<p>1、内存存储、持久化，内存是断电即失的，所以持久化很重要（RDB、AOF）</p>
<p>2、效率高，可以用于高速缓存</p>
<p>3、发布订阅系统</p>
<p>4、地图信息分析</p>
<p>5、计时器、计数器（浏览量！）</p>
<p>6、……</p>
<blockquote>
<p>特性</p>
</blockquote>
<p>1、多样的数据类型</p>
<p>2、持久化</p>
<p>3、集群</p>
<p>4、事务</p>
<p>5、……</p>
<blockquote>
<p>学习中需要用到的东西</p>
</blockquote>
<p>1、官网：<a href="https://redis.io/" target="_blank" rel="noopener">https://redis.io/</a></p>
<p>2、中文网：<a href="http://www.redis.cn/" target="_blank" rel="noopener">http://www.redis.cn/</a></p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E4%BB%8B%E7%BB%8D.png" alt="redis介绍"></p>
<p>3、下载地址：通过官网下载即可！</p>
<p>注意：Windows在GitHub上下载（停更很久了）</p>
<p>Redis推荐在Linux服务器上搭建</p>
<h2 id="Windows安装"><a href="#Windows安装" class="headerlink" title="Windows安装"></a>Windows安装</h2><h3 id="下载压缩包："><a href="#下载压缩包：" class="headerlink" title="下载压缩包："></a>下载压缩包：</h3><p><a href="https://github.com/MicrosoftArchive/redis/tags" target="_blank" rel="noopener">https://github.com/MicrosoftArchive/redis/tags</a></p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E5%8E%8B%E7%BC%A9%E5%8C%85.png" alt="redis压缩包"></p>
<h3 id="解压到电脑的环境目录下"><a href="#解压到电脑的环境目录下" class="headerlink" title="解压到电脑的环境目录下"></a>解压到电脑的环境目录下</h3><p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%8E%AF%E5%A2%83%E7%9B%AE%E5%BD%95.png" alt="环境目录"></p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E7%9B%AE%E5%BD%95.png" alt="redis目录"></p>
<h3 id="开启Redis，双击运行redis-server-exe"><a href="#开启Redis，双击运行redis-server-exe" class="headerlink" title="开启Redis，双击运行redis-server.exe"></a>开启Redis，双击运行redis-server.exe</h3><p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%8F%8C%E5%87%BB%E8%BF%90%E8%A1%8Credis%E6%9C%8D%E5%8A%A1.png" alt="双击运行redis服务"></p>
<h3 id="使用redis客户端连接redis，打开redis-cli-exe"><a href="#使用redis客户端连接redis，打开redis-cli-exe" class="headerlink" title="使用redis客户端连接redis，打开redis-cli.exe"></a>使用redis客户端连接redis，打开redis-cli.exe</h3><p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%89%93%E5%BC%80redis%E5%AE%A2%E6%88%B7%E7%AB%AF.png" alt="打开redis客户端"></p>
<h3 id="简单测试"><a href="#简单测试" class="headerlink" title="简单测试"></a>简单测试</h3><p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%AE%80%E5%8D%95%E6%B5%8B%E8%AF%95.png" alt="简单测试"></p>
<blockquote>
<p>Windows下使用很简单，但是Redis推荐我们使用Linux去开发使用！</p>
</blockquote>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E7%AE%80%E4%BB%8B.png" alt="redis简介"></p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E7%AE%80%E4%BB%8B%E4%B8%AD%E6%96%87%E7%89%88.png" alt="redis简介中文版"></p>
<h2 id="Linux安装"><a href="#Linux安装" class="headerlink" title="Linux安装"></a>Linux安装</h2><h3 id="查看可用的-Redis-版本"><a href="#查看可用的-Redis-版本" class="headerlink" title="查看可用的 Redis 版本"></a>查看可用的 Redis 版本</h3><p>dockerhub网址：<a href="https://hub.docker.com/_/redis?tab=tags" target="_blank" rel="noopener">https://hub.docker.com/_/redis?tab=tags</a></p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/dockerhub.png" alt="dockerhub"></p>
<h3 id="取最新版的-Redis-镜像"><a href="#取最新版的-Redis-镜像" class="headerlink" title="取最新版的 Redis 镜像"></a>取最新版的 Redis 镜像</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis:6.0.6</span><br></pre></td></tr></table></figure>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%8B%89%E5%8F%96%E9%95%9C%E5%83%8F.png" alt="拉取镜像"></p>
<h3 id="查看本地镜像"><a href="#查看本地镜像" class="headerlink" title="查看本地镜像"></a>查看本地镜像</h3><p>使用以下命令来查看是否已安装了 redis：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker images | grep redis</span><br></pre></td></tr></table></figure>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%9F%A5%E7%9C%8B%E9%95%9C%E5%83%8F.png" alt="查看镜像"></p>
<h3 id="运行容器，并做好端口映射"><a href="#运行容器，并做好端口映射" class="headerlink" title="运行容器，并做好端口映射"></a>运行容器，并做好端口映射</h3><p>安装完成后，我们可以使用以下命令来运行 redis 容器：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -itd --name redis_ycx -p 46379:6379 -p 46322:22 redis:6.0.6 /bin/bash</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<blockquote>
<p> -p 46379:6379: 映射容器服务的 6379 端口到宿主机的 46379端口。外部可以直接通过宿主机ip:46379访问到 Redis 的服务。</p>
</blockquote>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E8%BF%90%E8%A1%8C%E9%95%9C%E5%83%8F.png" alt="运行镜像"></p>
<h3 id="安装成功"><a href="#安装成功" class="headerlink" title="安装成功"></a>安装成功</h3><p>我们可以通过 <strong>docker ps</strong> 命令查看容器的运行信息：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps | grep redis_ycx</span><br></pre></td></tr></table></figure>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%9F%A5%E7%9C%8B%E5%AE%B9%E5%99%A8%E8%BF%90%E8%A1%8C%E4%BF%A1%E6%81%AF.png" alt="查看容器运行信息"></p>
<h3 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a>进入容器</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it redis_ycx /bin/bash</span><br></pre></td></tr></table></figure>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E8%BF%9B%E5%85%A5%E5%AE%B9%E5%99%A8.png" alt="进入容器"></p>
<h3 id="设置root用户密码"><a href="#设置root用户密码" class="headerlink" title="设置root用户密码"></a>设置root用户密码</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd root</span><br></pre></td></tr></table></figure>
<h3 id="更新apt"><a href="#更新apt" class="headerlink" title="更新apt"></a>更新apt</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br></pre></td></tr></table></figure>
<h3 id="安装vim"><a href="#安装vim" class="headerlink" title="安装vim"></a>安装vim</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install vim</span><br></pre></td></tr></table></figure>
<h3 id="ssh-permission-denied问题解决"><a href="#ssh-permission-denied问题解决" class="headerlink" title="ssh permission denied问题解决"></a>ssh permission denied问题解决</h3><p>修改/etc/ssh/sshd_config文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure>
<p>将相应行<strong>PermitRootLogin </strong>改为<strong>*PermitRootLogin yes</strong></p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E4%BF%AE%E6%94%B9sshd_config%E6%96%87%E4%BB%B6.png" alt="修改sshd_config文件"></p>
<h3 id="安装SSH-server"><a href="#安装SSH-server" class="headerlink" title="安装SSH server"></a>安装SSH server</h3><blockquote>
<p>Ubuntu 默认已安装了 SSH client</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install openssh-server</span><br></pre></td></tr></table></figure>
<h3 id="启动SSH服务"><a href="#启动SSH服务" class="headerlink" title="启动SSH服务"></a>启动SSH服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service ssh start</span><br></pre></td></tr></table></figure>
<h3 id="使用如下命令登陆本机"><a href="#使用如下命令登陆本机" class="headerlink" title="使用如下命令登陆本机"></a>使用如下命令登陆本机</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh localhost</span><br></pre></td></tr></table></figure>
<p>此时会有如下提示(SSH首次登陆提示)，输入 yes 。然后按提示输入密码，这样就登陆到本机了。</p>
<h3 id="免密登录"><a href="#免密登录" class="headerlink" title="免密登录"></a>免密登录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/.ssh/                     <span class="comment"># 若没有该目录，请先执行一次ssh localhost</span></span><br><span class="line">ssh-keygen -t rsa              <span class="comment"># 会有提示，都按回车就可以</span></span><br><span class="line">cat id_rsa.pub &gt;&gt; authorized_keys  <span class="comment"># 加入授权</span></span><br><span class="line">chmod 600 ./authorized_keys    <span class="comment"># 修改文件权限</span></span><br></pre></td></tr></table></figure>
<h3 id="使用shereis命名查看redis安装目录"><a href="#使用shereis命名查看redis安装目录" class="headerlink" title="使用shereis命名查看redis安装目录"></a>使用shereis命名查看redis安装目录</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">whereis redis-cli</span><br></pre></td></tr></table></figure>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E5%AE%89%E8%A3%85%E7%9B%AE%E5%BD%95.png" alt="redis安装目录"></p>
<h3 id="创建自己的redis配置文件"><a href="#创建自己的redis配置文件" class="headerlink" title="创建自己的redis配置文件"></a>创建自己的redis配置文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/bin</span><br><span class="line">mkdir myredisconifg <span class="comment"># 创建myredisconifg目录</span></span><br><span class="line">vim redis.conf <span class="comment"># 创建配置文件</span></span><br></pre></td></tr></table></figure>
<p>去github查看redis.conf的内容（docker默认是没有配置的），将内容复制到redis.conf文件中</p>
<h3 id="redis默认不是后台启动的，需要修改配置文件redis-conf"><a href="#redis默认不是后台启动的，需要修改配置文件redis-conf" class="headerlink" title="redis默认不是后台启动的，需要修改配置文件redis.conf"></a>redis默认不是后台启动的，需要修改配置文件redis.conf</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim redis.conf</span><br><span class="line">/daemonize <span class="comment"># 在vim中查找daemonize文本</span></span><br><span class="line">daemonize yes <span class="comment"># 允许后台启动，以守护进程的方式启动</span></span><br></pre></td></tr></table></figure>
<h3 id="启动redis服务"><a href="#启动redis服务" class="headerlink" title="启动redis服务"></a>启动redis服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/bin</span><br><span class="line">redis-server myredisconifg/redis.conf <span class="comment"># 通过指定的配置文件启动服务</span></span><br></pre></td></tr></table></figure>
<h3 id="测试redis"><a href="#测试redis" class="headerlink" title="测试redis"></a>测试redis</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/bin</span><br><span class="line">redis-cli -p 6379 <span class="comment"># 使用redis客户端测试连接，指定端口号，默认6379</span></span><br><span class="line">ping <span class="comment"># 测试是否连通</span></span><br><span class="line"><span class="built_in">set</span> name yan <span class="comment"># 设置key value</span></span><br><span class="line">get name <span class="comment"># 获取指定key的value</span></span><br><span class="line">keys * <span class="comment"># 查看所有的key</span></span><br></pre></td></tr></table></figure>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%B5%8B%E8%AF%95redis.png" alt="测试redis"></p>
<h3 id="查看redis进程是否开启"><a href="#查看redis进程是否开启" class="headerlink" title="查看redis进程是否开启"></a>查看redis进程是否开启</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep redis</span><br></pre></td></tr></table></figure>
<h3 id="如何关闭redis服务"><a href="#如何关闭redis服务" class="headerlink" title="如何关闭redis服务"></a>如何关闭redis服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 进程号 <span class="comment"># 上一步查出的redis进程号</span></span><br></pre></td></tr></table></figure>
<h2 id="测试性能"><a href="#测试性能" class="headerlink" title="测试性能"></a>测试性能</h2><p>redis-benchmark是一个压力测试工具</p>
<p>官方自带的性能测试工具</p>
<p>redis-benchmark命令参数：</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/benchmark%E5%8F%82%E6%95%B0.png" alt="benchmark参数"></p>
<p>简单测试：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 测试：100个并发连接，100000请求</span></span><br><span class="line">redis-benchmark -h localhost -p 6379 -c 100 -n 100000</span><br></pre></td></tr></table></figure>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C.png" alt="压力测试结果"></p>
<h2 id="redis-cli"><a href="#redis-cli" class="headerlink" title="redis-cli"></a>redis-cli</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h host -p port -a password</span><br></pre></td></tr></table></figure>
<h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p>redis默认有16个数据库</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E9%BB%98%E8%AE%A416%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93.png" alt="默认16个数据库"></p>
<p>默认使用的是第0个</p>
<p>可以使用select进行切换</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">select 3 <span class="comment"># 切换到3号数据库</span></span><br><span class="line">dbsize <span class="comment"># 查看数据库大小</span></span><br><span class="line"><span class="built_in">set</span> key value <span class="comment"># 设置key，value</span></span><br><span class="line">get key <span class="comment"># 根据key获取对应的value</span></span><br><span class="line">keys * <span class="comment"># 查看当前数据库所有的key</span></span><br><span class="line">flushdb <span class="comment"># 清空当前数据库</span></span><br><span class="line">flushall <span class="comment"># 清空所有数据库</span></span><br></pre></td></tr></table></figure>
<p>思考：为什么redis是6379？（女明星MERZ手机9宫格输入法对应数字6379）</p>
<blockquote>
<p>Redis是单线程的！</p>
</blockquote>
<p>Redis是基于内存操作的，CPU不是Redis的性能瓶颈，Redis的瓶颈是机器的内存和网络带宽。</p>
<p>Redis是C语言写的，官方提供的数据为100000+的QPS，完全不比同样是使用key-value的Memecache差</p>
<p><strong>Redis为什么单线程这么快？</strong></p>
<p>误区1：高性能的服务器一定是多线程的？</p>
<p>误区2：多线程（CPU上下文切换！）一定比单线程效率高？</p>
<p>速度：CPU&gt;内存&gt;硬盘</p>
<p>核心：Redis是将所有的数据全部放在内存中的，所以使用单线程去操作效率高，多线程（CPU上下文切换是耗时的操作），对于内存系统来说，如果没有上下文切换，效率就是最高的，多次读写都是在一个CPU上，在内存情况下，这个就是最佳的方案。（IO多路复用）</p>
<h1 id="五大基本数据类型"><a href="#五大基本数据类型" class="headerlink" title="五大基本数据类型"></a>五大基本数据类型</h1><p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/5%E5%A4%A7%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B.png" alt="5大基本数据类型"></p>
<p><strong>翻译：</strong></p>
<p>Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作数据库、缓存和消息中间件。 它支持多种类型的数据结构，如 <a href="http://www.redis.cn/topics/data-types-intro.html#strings" target="_blank" rel="noopener">字符串（strings）</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#hashes" target="_blank" rel="noopener">散列（hashes）</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#lists" target="_blank" rel="noopener">列表（lists）</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#sets" target="_blank" rel="noopener">集合（sets）</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#sorted-sets" target="_blank" rel="noopener">有序集合（sorted sets）</a> 与范围查询， <a href="http://www.redis.cn/topics/data-types-intro.html#bitmaps" target="_blank" rel="noopener">bitmaps</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#hyperloglogs" target="_blank" rel="noopener">hyperloglogs</a> 和 <a href="http://www.redis.cn/commands/geoadd.html" target="_blank" rel="noopener">地理空间（geospatial）</a> 索引半径查询。 Redis 内置了 <a href="http://www.redis.cn/topics/replication.html" target="_blank" rel="noopener">复制（replication）</a>，<a href="http://www.redis.cn/commands/eval.html" target="_blank" rel="noopener">LUA脚本（Lua scripting）</a>， <a href="http://www.redis.cn/topics/lru-cache.html" target="_blank" rel="noopener">LRU驱动事件（LRU eviction）</a>，<a href="http://www.redis.cn/topics/transactions.html" target="_blank" rel="noopener">事务（transactions）</a> 和不同级别的 <a href="http://www.redis.cn/topics/persistence.html" target="_blank" rel="noopener">磁盘持久化（persistence）</a>， 并通过 <a href="http://www.redis.cn/topics/sentinel.html" target="_blank" rel="noopener">Redis哨兵（Sentinel）</a>和自动 <a href="http://www.redis.cn/topics/cluster-tutorial.html" target="_blank" rel="noopener">分区（Cluster）</a>提供高可用性（high availability）。</p>
<h2 id="Redis-Key"><a href="#Redis-Key" class="headerlink" title="Redis-Key"></a>Redis-Key</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">select 3 <span class="comment"># 切换到3号数据库</span></span><br><span class="line">dbsize <span class="comment"># 查看数据库大小</span></span><br><span class="line"><span class="built_in">set</span> key value <span class="comment"># 设置key，value</span></span><br><span class="line">get key <span class="comment"># 根据key获取对应的value</span></span><br><span class="line">flushdb <span class="comment"># 清空当前数据库</span></span><br><span class="line">flushall <span class="comment"># 清空所有数据库</span></span><br><span class="line">keys * <span class="comment"># 查看所有的key</span></span><br><span class="line">exists name <span class="comment"># 判断是否有值为 name 的key</span></span><br><span class="line">move name 1 <span class="comment"># 将 name 移动到1号数据库</span></span><br><span class="line">del name <span class="comment"># 删除值为 name 的key</span></span><br><span class="line">expire name 10 <span class="comment"># 设置 name 的过期时间(单位s)</span></span><br><span class="line">ttl name <span class="comment"># 查看当前 name 的过期时间</span></span><br><span class="line"><span class="built_in">type</span> name <span class="comment"># 查看 name 的类型</span></span><br></pre></td></tr></table></figure>
<p>参数查询：<a href="http://www.redis.cn/commands.html" target="_blank" rel="noopener">http://www.redis.cn/commands.html</a></p>
<h2 id="String（字符串）"><a href="#String（字符串）" class="headerlink" title="String（字符串）"></a>String（字符串）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="built_in">set</span> key1 v1</span><br><span class="line">get key1 <span class="comment"># v1</span></span><br><span class="line">append key1 hello <span class="comment"># 在key1对应的value后追加字符串hello，如果当前key不存在，就相当于set key</span></span><br><span class="line">get key1 <span class="comment"># v1hello</span></span><br><span class="line">strlen key1 <span class="comment"># 查看 key1 对应的value的字符串长度</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="built_in">set</span> views 0 <span class="comment"># 初始浏览量为0</span></span><br><span class="line">incr views <span class="comment"># views的值+1</span></span><br><span class="line">decr views <span class="comment"># views的值-1</span></span><br><span class="line">incrby views 10 <span class="comment"># views的值+10</span></span><br><span class="line">decrby views 5 <span class="comment"># views的值-5</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment"># 字符串范围 range</span></span><br><span class="line"><span class="built_in">set</span> key1 hello,world!</span><br><span class="line">getrange key1 0 3 <span class="comment"># 截取字符串，范围：0-3，结果：hell</span></span><br><span class="line">getrange key1 0 -1 <span class="comment"># 截取全部字符串，效果等同与get key1，结果：hello,world!</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 替换字符串</span></span><br><span class="line"><span class="built_in">set</span> key2 abcdefg</span><br><span class="line">setrange key2 1 xx <span class="comment"># 从位置1开始替换字符串，结果：axxdefg</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment"># setex (set with expire)  # 设置key并设置过期时间</span></span><br><span class="line"><span class="comment"># setnx (set if not exist) # key不存在才设置，在分布式锁中会常常使用！</span></span><br><span class="line">setex key3 30 hello2 <span class="comment"># 设置key3的值为hello2，过期时间为30s</span></span><br><span class="line">setnx mykey redis <span class="comment"># mykey不存在，才设置mykey，值为redis，如果mykey存在，就会设置失败，返回0</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment"># mset # 批量设置key的value</span></span><br><span class="line"><span class="comment"># mget # 批量获取key的value</span></span><br><span class="line"><span class="comment"># msetnx # 如果不存在，就设置，原子性操作，其中有一个key存在，就都不会设置成功</span></span><br><span class="line">mset k1 v1 k2 v2 k3 v3 <span class="comment"># 设置k1的value为v1，k2的value为v2，k3的value为v3</span></span><br><span class="line">mget k1 k2 k3 <span class="comment"># 获取k1,k2,k3的值，结果：v1,v2,v3</span></span><br><span class="line">msetnx k1 a1 k2 a2 k4 v4 <span class="comment"># k1, k2存在，所以全部设置失败，k4也不会设置</span></span><br><span class="line">get k4 <span class="comment"># (nil)</span></span><br><span class="line"><span class="comment"># 对象</span></span><br><span class="line"><span class="built_in">set</span> user:1 &#123;name:zhangsan,age:3&#125; <span class="comment"># 设置一个user:1对象，值为json字符串，用来保存一个对象</span></span><br><span class="line">mset user:1:name zhangsan user:1:age 2 <span class="comment"># 方式二，这里的key：user:&#123;id&#125;:&#123;field&#125;</span></span><br><span class="line">mget user:1:name user:1:age <span class="comment"># 1) "zhangsan" 2) "2"</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment"># getset # 先get再set</span></span><br><span class="line">getset db redis <span class="comment"># 返回(nil)</span></span><br><span class="line">get db <span class="comment"># 再次获取，值为redis</span></span><br></pre></td></tr></table></figure>
<p><strong>String的使用场景：</strong>value除了字符串还可以是数字！</p>
<ul>
<li>计数器</li>
<li>统计多单位的数量</li>
<li>粉丝数</li>
<li>对象缓存存储</li>
</ul>
<h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><blockquote>
<p>基本的数据类型，列表</p>
</blockquote>
<p>在redis里面，可以把list玩成：栈、队列、阻塞队列！</p>
<p><strong>redis不区分大小写命令</strong></p>
<p>所有的list命令都是用l或r开头的，可以理解为<strong>双端队列</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#################################################################</span></span><br><span class="line">lpush list one <span class="comment"># 将一个值或多个值，从左侧放入列表</span></span><br><span class="line">lpush list two three</span><br><span class="line">lrange list 0 -1 <span class="comment"># 从左开始，获取列表的所有值，three two one</span></span><br><span class="line">rpush list four <span class="comment"># 将一个值或多个值，从右侧放入列表</span></span><br><span class="line">lrange list 0 -1 <span class="comment"># 从左开始，获取列表的所有值，three two one four</span></span><br><span class="line">lrange list 0 1 <span class="comment"># 从左开始，获取列表的第0个到第1个值，three two</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment"># lpop # 从列表左侧移除第一个元素，返回该元素</span></span><br><span class="line"><span class="comment"># rpop # 从列表右侧移除第一个元素，返回该元素</span></span><br><span class="line">lpop list <span class="comment"># 从列表左侧移除第一个元素，返回three</span></span><br><span class="line">rpop list <span class="comment"># 从列表右侧移除第一个元素，返回four</span></span><br><span class="line">lrange list 0 -1 <span class="comment"># two one</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment"># lindex 从左侧，通过下标获取某一个值</span></span><br><span class="line">lindex list 0 <span class="comment"># 获取下标为0的值，two</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment"># llen 获取列表的长度</span></span><br><span class="line">llen list <span class="comment"># 2</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment"># lrem: 移除list列表中，指定个数的value，精确匹配</span></span><br><span class="line">lrem list 2 three <span class="comment"># 从左侧开始，移除两个值为three的元素</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment"># ltrim: 截取指定范围的元素</span></span><br><span class="line">rpush list hello1 hello2 hello3 hello4</span><br><span class="line">lrange list 0 -1 <span class="comment"># hello1 hello2 hello3 hello4</span></span><br><span class="line">ltrim list 1 2 <span class="comment"># 截取[1,2]范围的值</span></span><br><span class="line">lrange list 0 -1 <span class="comment"># hello2 hello3</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment"># rpoplpush：将列表右侧第一个元素，从左侧移动到另一个列表中</span></span><br><span class="line">rpush list hello1 hello2 hello3 hello4</span><br><span class="line">lrange list 0 -1 <span class="comment"># hello1 hello2 hello3 hello4</span></span><br><span class="line">rpoplpush list mylist <span class="comment"># 返回：hello4</span></span><br><span class="line">lrange list 0 -1 <span class="comment"># hello1 hello2 hello3</span></span><br><span class="line">lrange mylist 0 -1 <span class="comment"># hello4</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment"># lset：通过下标赋值，前提是列表存在，且下标没有越界</span></span><br><span class="line">rpush list asd <span class="comment"># asd</span></span><br><span class="line">lset list 0 a1 <span class="comment"># 将下标为0的值设置为a1（更新操作）</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment"># linsert: 在某个值的前面或后面插入一个值（从左开始找指定值，然后在其前面或后面插入一个值）</span></span><br><span class="line">rpush list h1 h2 h3 h4 h2 <span class="comment"># h1 h2 h3 h4 h2</span></span><br><span class="line">linsert list before h2 h8 <span class="comment"># 从左开始，在h2前面插入h8，结果：h1 h8 h2 h3 h4 h2</span></span><br></pre></td></tr></table></figure>
<p><strong>小结：</strong></p>
<ul>
<li>list底层是双向链表</li>
<li>如果key不存在，创建新链表</li>
<li>如果key存在，新增内容</li>
<li>如果移除了所有值，空链表，代表不存在</li>
<li>在两边插入或者改动，效率最高！操作中间元素，效率相对较低</li>
<li>队列：lpush rpop</li>
<li>栈：lpush lpop</li>
</ul>
<h2 id="Set（集合）"><a href="#Set（集合）" class="headerlink" title="Set（集合）"></a>Set（集合）</h2><blockquote>
<p>set中的值是不重复的，无序的</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#################################################################</span></span><br><span class="line">sadd myset hello <span class="comment"># myset集合中添加一个值hello</span></span><br><span class="line">smembers myset <span class="comment"># 查看myset中的所有元素</span></span><br><span class="line">sismember myset hello <span class="comment"># 查看myset集合中是否包含值hello</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line">scard myset <span class="comment"># 查看myset集合的元素个数</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line">srem myset hello <span class="comment"># 移除myset集合中的hello元素</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line">srandmember myset <span class="comment"># 随机抽选出myset集合中的1个元素</span></span><br><span class="line">srandmember myset 2 <span class="comment"># 随机抽选出myset集合中的2个元素</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment"># 随机移除集合中的一个元素</span></span><br><span class="line">spop myset <span class="comment"># 随机移除myset集合中的一个元素，返回该元素: hello</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment"># 将一个指定的值移动到另外一个set集合中</span></span><br><span class="line">smove myset myset2 hello <span class="comment"># 将myset集合中的hello元素移动到myset2集合中</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment"># 交集，并集，差集，补集</span></span><br><span class="line">sadd key1 a b c <span class="comment"># a b c</span></span><br><span class="line">sadd key1 c d e <span class="comment"># c d e</span></span><br><span class="line">sdiff key1 key2 <span class="comment"># key1集合和key2集合做差集，返回key1集合中除开key2集合的那部分：a b</span></span><br><span class="line">sinter key1 key2 <span class="comment"># key1集合和key2集合做交集，返回c</span></span><br><span class="line">sunion key1 key2 <span class="comment"># key1集合和key2集合做并集，返回a b c d e</span></span><br><span class="line"><span class="comment"># 补集可由差集和交集实现</span></span><br></pre></td></tr></table></figure>
<p><strong>应用场景：</strong></p>
<p>微博，A用户将所有关注的人放入一个set集合中，将他的粉丝也放入一个集合中！</p>
<p>交集：共同关注、共同爱好、二度好友、推荐好友！（六度分隔理论）</p>
<p><strong>补充（Java实现交并差）：</strong></p>
<blockquote>
<p>下面的方法会改变A集合</p>
</blockquote>
<p>交集：A.retainAll(B) </p>
<p>并集：A.addAll(B)</p>
<p>差集：A.removeAll(B)</p>
<h2 id="Hash-哈希"><a href="#Hash-哈希" class="headerlink" title="Hash(哈希)"></a>Hash(哈希)</h2><p>Map集合，key-value</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#################################################################</span></span><br><span class="line">hset myhash field1 xiaoqiang field2 hello <span class="comment"># 添加一个或多个key-value</span></span><br><span class="line">hget myhash field1 <span class="comment"># 获取myhash中field1的value值</span></span><br><span class="line">hmset myhash field1 xiaoqiang field2 hello field3 world <span class="comment"># 添加一个或多个key-value，效果和hset一样（相同key的value会被更新）</span></span><br><span class="line">hmget myhash field1 field2 <span class="comment"># 批量获取多个key的value值</span></span><br><span class="line">hgetall myhash <span class="comment"># 获取myhash中的所有key和value</span></span><br><span class="line">hdel myhash field1 <span class="comment"># 删除myhash中key为field1的键值对，可以同时删除多个</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line">hlen myhash <span class="comment"># 获取myhash的长度</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line">hexists myhash field1 <span class="comment"># 判断myhash中key为field1的字段是否存在</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line">hkeys myhash <span class="comment"># 获取myhash中所有的key</span></span><br><span class="line">hvals myhash <span class="comment"># 获取myhash中所有的value</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line">hincrby myhash field1 3  <span class="comment"># key为field1的value自增3</span></span><br><span class="line">hincrby myhash field1 -3 <span class="comment"># key为field1的value自减3</span></span><br><span class="line">hsetnx myhash field4 hello <span class="comment"># myhash中若不存在key为field4的键值对，则会添加该键值对，否则添加失败</span></span><br></pre></td></tr></table></figure>
<p><strong>hash更适合对象的存储！</strong></p>
<p><strong>String更适合字符串存储！</strong></p>
<h2 id="Zset-有序集合"><a href="#Zset-有序集合" class="headerlink" title="Zset(有序集合)"></a>Zset(有序集合)</h2><p>在Set的基础上，增加了一个值，用于排序，zadd 集合名 用于排序的score 元素</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#################################################################</span></span><br><span class="line">zadd myset 1 one         <span class="comment"># 添加一个值</span></span><br><span class="line">zadd myset 2 two 3 three <span class="comment"># 添加多个值</span></span><br><span class="line">zrange myset 0 -1 <span class="comment"># 获取myset集合中的所有值，one two three</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment"># 排序如何实现</span></span><br><span class="line"><span class="comment"># zrangebyscore key 最小值 最大值</span></span><br><span class="line">zadd myset 2500 xiaoming 5000 zhangsan 500 kuang <span class="comment"># 添加3个用户</span></span><br><span class="line">zrangebyscore salary -inf +inf <span class="comment"># 显示全部的用户，根据score，从小到大排序</span></span><br><span class="line">zrangebyscore salary -inf 2500 <span class="comment"># 只排序score为 -inf到2500 的元素，从小到大排序</span></span><br><span class="line">zrangebyscore salary -inf 2500 withscores <span class="comment"># 排序结果带上score kuang 500 xiaoming 2500</span></span><br><span class="line">zrevrangebyscore salary +inf -inf <span class="comment"># 根据score，从大到小排序，排序所有用户</span></span><br><span class="line">zrevrange salary 0 -1 <span class="comment"># 从大到小进行排序</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment"># 移除元素</span></span><br><span class="line">zrem salary xiaoming kuang <span class="comment"># 移除一个或多个元素</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line">zcard salary <span class="comment"># 获取salary有序集合中有多少个元素</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line">zadd myset 1 hello 2 world 3 kuang</span><br><span class="line">zcount myset 1 3 <span class="comment"># 获取score在[1,3]区间有多少个元素，返回：3</span></span><br></pre></td></tr></table></figure>
<p>其余的一些api，可以查看官方文档。</p>
<p>案例思路：set 排序 存储班级成绩表，工资表排序</p>
<p>普通消息，1，重要信息，2，带权重进行判断</p>
<p>排行榜应用实现，取Top N 测试</p>
<h1 id="三种特殊数据类型"><a href="#三种特殊数据类型" class="headerlink" title="三种特殊数据类型"></a>三种特殊数据类型</h1><h2 id="geospatial地址位置"><a href="#geospatial地址位置" class="headerlink" title="geospatial地址位置"></a>geospatial地址位置</h2><blockquote>
<p>朋友的定位，附近的人，打车距离计算</p>
</blockquote>
<p>Redis的Geo在Redis3.2版本就推出了！这个功能可以推算地理位置的信息，两地之间的距离，方圆几里的人！</p>
<p>可以查询一些测试数据：<a href="http://www.jsons.cn/lngcode/" target="_blank" rel="noopener">http://www.jsons.cn/lngcode/</a></p>
<p>只有6个命令</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/6%E4%B8%AA%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%E5%91%BD%E4%BB%A4.png" alt="6个地理位置命令"></p>
<blockquote>
<p>geoadd 添加地理位置</p>
<p>geoadd key longitude latitude member [longitude latitude member …]</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># geoadd 添加地理位置</span></span><br><span class="line"><span class="comment"># geoadd key 经度 维度 名称</span></span><br><span class="line"><span class="comment"># 有效的经度从-180度到180度。</span></span><br><span class="line"><span class="comment"># 有效的纬度从-85.05112878度到85.05112878度。</span></span><br><span class="line"><span class="comment"># 当坐标位置超出上述指定范围时，该命令将会返回一个错误。</span></span><br><span class="line"><span class="comment"># 规则：两级无法直接添加，我们一般会下载城市数据，直接通过Java程序一次性导入！</span></span><br><span class="line">geoadd china:city 116.405285 39.904989 beijing 121.472644 31.231706 shanghai <span class="comment"># 可以一次性导入多个值，添加了北京和上海的地理信息</span></span><br><span class="line">geoadd china:city 106.504962 29.533155 chongqing <span class="comment">#添加重庆的地理信息</span></span><br><span class="line">geoadd china:city 114.085947 22.547 shenzhen <span class="comment"># 添加深圳的地理信息</span></span><br><span class="line">geoadd china:city 120.153576 30.287459 hangzhou <span class="comment"># 添加杭州的地理信息</span></span><br><span class="line">geoadd china:city 108.948024 34.263161 xian <span class="comment"># 添加西安的地理信息</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>geopos 从<code>key</code>里返回所有给定位置元素的位置（经度和纬度）</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geopos china:city xian <span class="comment"># 获取西安的经度和纬度 108.94802302122116089 34.2631604414749944</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>GEODIST key member1 member2 [unit]</p>
<p>返回两个给定位置之间的距离。</p>
<p>如果两个位置之间的其中一个不存在， 那么命令返回空值。</p>
</blockquote>
<p>指定单位的参数 unit 必须是以下单位的其中一个：</p>
<ul>
<li><strong>m</strong> 表示单位为米。</li>
<li><strong>km</strong> 表示单位为千米。</li>
<li><strong>mi</strong> 表示单位为英里。</li>
<li><strong>ft</strong> 表示单位为英尺。</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geodist china:city beijing shanghai km <span class="comment"># 计算北京和上海之间的距离，单位为km，返回：1067.5980</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>georadius 以给定的经纬度为中心， 返回键包含的位置元素当中， 与中心的距离不超过给定最大距离的所有位置元素。</p>
</blockquote>
<p>范围可以使用以下其中一个单位：</p>
<ul>
<li><strong>m</strong> 表示单位为米。</li>
<li><strong>km</strong> 表示单位为千米。</li>
<li><strong>mi</strong> 表示单位为英里。</li>
<li><strong>ft</strong> 表示单位为英尺。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">georadius china:city 110 30 1000 km # 获取 经度110 纬度30 这个点方圆1000km范围内的元素</span><br><span class="line">georadius china:city 110 30 1000 km withdist # 结果带每个元素距离 经度110 纬度30 这个点的直线距离</span><br><span class="line">georadius china:city 110 30 1000 km withcoord # 结果带每个元素的经纬度</span><br><span class="line">georadius china:city 110 30 1000 km count 2 # 只显示两个查询结果</span><br></pre></td></tr></table></figure>
<blockquote>
<p>georadiusbymember key member radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count]</p>
<p>这个命令和 <a href="http://www.redis.cn/commands/georadius.html" target="_blank" rel="noopener">GEORADIUS</a> 命令一样， 都可以找出位于指定范围内的元素， 但是 <code>GEORADIUSBYMEMBER</code> 的中心点是由给定的位置元素决定的， 而不是像 <a href="http://www.redis.cn/commands/georadius.html" target="_blank" rel="noopener">GEORADIUS</a> 那样， 使用输入的经度和纬度来决定中心点</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 找出指定元素周围的其他元素！</span></span><br><span class="line">georadiusbymember china:city beijing 1000 km <span class="comment"># 找出以北京为中心，方圆1000km内的元素，beijing xian</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>geohash key member [member …]</p>
</blockquote>
<p>返回一个或多个位置元素的 <a href="https://en.wikipedia.org/wiki/Geohash" target="_blank" rel="noopener">Geohash</a> 表示。</p>
<p>该命令将返回11个字符的Geohash字符串。如果两个字符串越接近，那么这两个点距离越近！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">geohash china:city beijing chongqing <span class="comment"># 返回北京和重庆的Geohash字符串，wx4g0b7xrt0，wm78p86e170</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>geo底层的实现原理是Zset，我们可以使用Zset命令来操作geo！</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span> china:city <span class="comment"># 查看china:city的类型：zset</span></span><br><span class="line">zrange china:city 0 -1 <span class="comment"># 获取所有的城市，chongqing、xian、shenzhen、shanghai、beijing</span></span><br><span class="line">zrem china:city beijing <span class="comment"># 移除beijing这个元素</span></span><br><span class="line">zrange china:city 0 -1 <span class="comment"># chongqing、xian、shenzhen、shanghai</span></span><br></pre></td></tr></table></figure>
<h2 id="Hyperloglog"><a href="#Hyperloglog" class="headerlink" title="Hyperloglog"></a>Hyperloglog</h2><blockquote>
<p>什么是基数？</p>
</blockquote>
<p>基数：集合中不重复元素的个数</p>
<p>A：{1, 3, 5, 7, 8, 7}，基数为5</p>
<blockquote>
<p>简介</p>
</blockquote>
<p>Hyperloglog 是关于基数统计的算法！</p>
<p>优点：占用的内存是固定的，2^64不同元素的技术，只需要废12KB内存！如果要从内存角度来比较的话hyperloglog首选！</p>
<p>网页的UV（网站的浏览量），一个人访问一个网站多次，算作一次。</p>
<p>传统的方式，set保存用户的id，然后就可以统计set中元素的数量作为标准判断！</p>
<p>这个方式如果保存大量的用户id，就会比较麻烦！我们的目的是为了计数，而不是保存用户id；</p>
<p>0.81%错误率！统计UV任务，可以忽略不计！</p>
<blockquote>
<p>测试使用</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pfadd mykey a b c d e f g h i j i <span class="comment"># 创建第一组元素</span></span><br><span class="line">pfcount mykey <span class="comment"># 统计mykey中元素的基数数量，10</span></span><br><span class="line">pfadd mykey2 i j z x c v b n m <span class="comment"># 创建第二组元素 mykey2</span></span><br><span class="line">pfcount mykey2 9 <span class="comment"># 统计mykey2元素的基数数量，9</span></span><br><span class="line">pfmerge mykey3 mykey mykey2 <span class="comment"># 合并两组 mykey mykey2 =》 mykey3 并集</span></span><br><span class="line">pfcount mykey3 <span class="comment"># 15</span></span><br></pre></td></tr></table></figure>
<p>如果允许容错，那么一定可以使用Hyperloglog！</p>
<p>如果不允许容错，就使用set或者自己的数据类型即可！</p>
<h2 id="Bitmaps"><a href="#Bitmaps" class="headerlink" title="Bitmaps"></a>Bitmaps</h2><blockquote>
<p>位存储</p>
<p>Bitmaps和hash结合，就有了布隆过滤器，用于解决缓存击穿问题</p>
</blockquote>
<p>统计疫情感染人数：0 1 0 1</p>
<p>统计用户信息，活跃，不活跃，登录，未登录，打卡</p>
<p>两个状态的，都可以使用Bitmaps！</p>
<p><strong>Bitmaps位图</strong>，数据结构，都是操作二进制来进行记录，就只有0和1两个状态！</p>
<blockquote>
<p>例如：365天=365bit 1字节=8bit 46个字节左右</p>
<p>测试</p>
</blockquote>
<p>使用Bitmaps记录周一到周日的打卡：</p>
<p>周一：1 周二：0 周三：1 周四：1 周五：1 周六：1…</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; setbit sign 0 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 1 0</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 2 0</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 3 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 4 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 5 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit sign 6 1</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br></pre></td></tr></table></figure>
<p>查看某一天是否有打卡</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; getbit sign 3 <span class="comment"># 查看周四是否打卡</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>
<p>统计操作，统计打卡的天数！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; bitcount sign <span class="comment"># 统计这周的打卡天数</span></span><br><span class="line">(<span class="built_in">integer</span>) 5</span><br></pre></td></tr></table></figure>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><blockquote>
<p>MySQL：ACID</p>
<p>Redis单条命令是原子性的，但是事务不保证原子性！</p>
<p>Redis事务没有隔离级别的概念</p>
<p>所有的命令在事务中，并没有直接被执行！只有发起执行命令的时候才会执行！Exec</p>
</blockquote>
<p>Redis事务本质：一组命令的集合！一个事务中的所有命令都会被序列化，在事务执行过程中，会按照顺序执行！</p>
<p>一次性、顺序性、排他性！执行一系列的命令！</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--------队列 set set set 执行 -------</span><br></pre></td></tr></table></figure>
<p>redis的事务：</p>
<ul>
<li>开启事务（multi）</li>
<li>命令入队（…）</li>
<li>执行事务（exec）</li>
</ul>
<p>锁：Redis可以实现乐观锁</p>
<blockquote>
<p>执行事务</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi <span class="comment"># 开启事务</span></span><br><span class="line">OK</span><br><span class="line"><span class="comment"># 命令入队</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k3 v3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span> <span class="comment"># 执行事务</span></span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">3) <span class="string">"v2"</span></span><br><span class="line">4) OK</span><br></pre></td></tr></table></figure>
<blockquote>
<p>放弃事务</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi     <span class="comment"># 开启事务</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k4 v4</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; discard   <span class="comment"># 取消事务</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get key4  <span class="comment"># 事务队列中的命令都不会被执行</span></span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>编译型异常（代码有问题！命令有错！），事务中所有的命令都不会被执行！</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k3 v3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; getset k3 <span class="comment"># 错误的命令</span></span><br><span class="line">(error) ERR wrong number of arguments <span class="keyword">for</span> <span class="string">'getset'</span> <span class="built_in">command</span></span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k4 v4</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k5 v5</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span> <span class="comment"># 执行事务报错！</span></span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br><span class="line">127.0.0.1:6379&gt; get k4 <span class="comment"># 所有的命令都不会被执行</span></span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>运行时异常（1/0），如果事务队列中存在逻辑错误的命令，那么执行事务的时候，该命令不会被执行（错误命令抛出异常），但是其他命令照常执行！</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incr k1 <span class="comment"># 存在逻辑错误，会执行失败</span></span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k3 v3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; get k3</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span></span><br><span class="line">1) OK</span><br><span class="line">2) (error) ERR value is not an <span class="built_in">integer</span> or out of range <span class="comment"># 虽然 incr k1 这条命令报错了，但是其他命令依旧正常执行</span></span><br><span class="line">3) OK</span><br><span class="line">4) OK</span><br><span class="line">5) <span class="string">"v3"</span></span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line"><span class="string">"v2"</span></span><br><span class="line">127.0.0.1:6379&gt; get k3</span><br><span class="line"><span class="string">"v3"</span></span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line"><span class="string">"v1"</span></span><br></pre></td></tr></table></figure>
<h1 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h1><blockquote>
<p>watch：实现乐观锁</p>
</blockquote>
<p><strong>悲观锁：</strong>很悲观，认为什么时候都会出问题，无论做什么都会加锁！</p>
<p><strong>乐观锁：</strong>很乐观，认为什么时候都不会出问题，所以不会上锁！更新数据的时候去判断一下，在此期间是否有人修改过这个数据，没有就修改，有就不修改（CAS算法）</p>
<ul>
<li>获取version</li>
<li>更新的时候比较version</li>
</ul>
<blockquote>
<p>Redis测监视测试</p>
</blockquote>
<p>正常执行成功！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> money 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> out 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; watch money     <span class="comment"># 监视money对象</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi           <span class="comment"># 事务正常结束，数据期间没有发生变动，这个时候就正常执行成功！</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; decrby money 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incrby out 20</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 80</span><br><span class="line">2) (<span class="built_in">integer</span>) 20</span><br></pre></td></tr></table></figure>
<p>测试多线程修改值，使用watch可以进行redis的乐观锁操作！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> money 100</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> out 0</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; watch money     <span class="comment"># 监视money对象</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; decrby money 10</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incrby out 10</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span>            <span class="comment"># 执行之前，另外一个线程，修改了money的值，这个时候，事务就会执行失败，乐观锁，cas算法(compare and swap)</span></span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>
<p>如果修改失败，解锁，重新监视，获取最新值！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; unwatch          <span class="comment"># 如果事务执行失败，就先解锁</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; watch money      <span class="comment"># 重新监视money对象，获取最新的值，再次监视，相当于select version</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; decrby money 10</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; incrby out 10</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span>             <span class="comment"># 比对监视的值是否发生变化，如果没有发生变化，就执行成功，否则执行失败，执行失败就再执行上面两步（自旋锁）</span></span><br><span class="line">1) (<span class="built_in">integer</span>) 990</span><br><span class="line">2) (<span class="built_in">integer</span>) 10</span><br></pre></td></tr></table></figure>
<h1 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h1><blockquote>
<p>使用Java操作Redis</p>
</blockquote>
<h2 id="什么是Jedis？"><a href="#什么是Jedis？" class="headerlink" title="什么是Jedis？"></a>什么是Jedis？</h2><p>Jedis是官方推荐的Java连接开发工具！使用Java操作Redis的中间件！如果要使用Java操作Redis，一定要对Jedis十分熟悉！</p>
<blockquote>
<p>测试</p>
</blockquote>
<p>1、导入对应的依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--导入jedis的包--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/redis.clients/jedis --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.3.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--fastjson--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>fastjson<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.73<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、测试步骤</p>
<ul>
<li><p>连接redis数据库</p>
</li>
<li><p>操作命令</p>
</li>
<li>断开连接</li>
</ul>
<h2 id="用Jedis连接阿里云等服务器上的redis"><a href="#用Jedis连接阿里云等服务器上的redis" class="headerlink" title="用Jedis连接阿里云等服务器上的redis"></a>用Jedis连接阿里云等服务器上的redis</h2><ol>
<li>配置redis.conf<br>1.设置访问redis的密码：requirepass 要设置密码<br>2.注释bind 127.0.0.1<br>(重启redis-server服务,进入redis后要先验证密码,用这个命令：auth 密码 ,然后ping一下看有没有配置成功)</li>
<li>idea访问时添加auth密码<br>Jedis jedis = new Jedis(“服务器的外网ip”,6379);<br>jedis.auth(“redis的密码”);<br>System.out.println(jedis.ping());<br>（输出PONG的话就成功了）</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPing</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1、new Jedis对象即可</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"远程服务器ip地址"</span>, 端口号);</span><br><span class="line">        jedis.auth(<span class="string">"123456"</span>); <span class="comment">// redis登录密码，远程登录需要设置</span></span><br><span class="line">        <span class="comment">// jedis所有的命令就是我们之前学习的所有指令</span></span><br><span class="line">        <span class="comment">// 测试连接是否成功</span></span><br><span class="line">        System.out.println(jedis.ping());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%B5%8B%E8%AF%95%E8%BF%9E%E6%8E%A5.png" alt="测试连接"></p>
<h2 id="常用api"><a href="#常用api" class="headerlink" title="常用api"></a>常用api</h2><p>String</p>
<p>List</p>
<p>Set</p>
<p>Hash</p>
<p>Zset</p>
<blockquote>
<p>对key的操作命令</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Set;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPing</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1、new Jedis对象即可</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"远程服务器ip地址"</span>, 端口号);</span><br><span class="line">        jedis.auth(<span class="string">"123456"</span>); <span class="comment">// redis登录密码，远程登录需要设置</span></span><br><span class="line">        <span class="comment">// jedis所有的命令就是我们之前学习的所有指令</span></span><br><span class="line">        <span class="comment">// 测试连接是否成功</span></span><br><span class="line">        System.out.println(jedis.ping());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"清空数据："</span> + jedis.flushDB());</span><br><span class="line">        System.out.println(<span class="string">"判断某个键是否存在："</span> + jedis.exists(<span class="string">"username"</span>));</span><br><span class="line">        System.out.println(<span class="string">"新增&lt;'username', 'xiaoming'&gt;的键值对："</span> + jedis.set(<span class="string">"username"</span>, <span class="string">"xiaoming"</span>));</span><br><span class="line">        System.out.println(<span class="string">"新增&lt;'password', 'password'&gt;的键值对："</span> + jedis.set(<span class="string">"password"</span>, <span class="string">"password"</span>));</span><br><span class="line">        System.out.println(<span class="string">"系统中的所有键如下："</span>);</span><br><span class="line">        Set&lt;String&gt; keys = jedis.keys(<span class="string">"*"</span>);</span><br><span class="line">        System.out.println(keys);</span><br><span class="line">        System.out.println(<span class="string">"删除键password："</span> + jedis.del(<span class="string">"password"</span>));</span><br><span class="line">        System.out.println(<span class="string">"判断键password是否存在："</span> + jedis.exists(<span class="string">"password"</span>));</span><br><span class="line">        System.out.println(<span class="string">"查看键username所存储的值的类型："</span> + jedis.type(<span class="string">"username"</span>));</span><br><span class="line">        System.out.println(<span class="string">"随机返回key空间中的一个："</span> + jedis.randomKey());</span><br><span class="line">        System.out.println(<span class="string">"重命名key："</span> + jedis.rename(<span class="string">"username"</span>, <span class="string">"name"</span>));</span><br><span class="line">        System.out.println(<span class="string">"取出改后的name："</span> + jedis.get(<span class="string">"name"</span>));</span><br><span class="line">        System.out.println(<span class="string">"按索引查询："</span> + jedis.select(<span class="number">0</span>));</span><br><span class="line">        System.out.println(<span class="string">"删除当前选择数据中的所有key："</span> + jedis.flushDB());</span><br><span class="line">        System.out.println(<span class="string">"返回当前数据库中key的数目："</span> + jedis.dbSize());</span><br><span class="line">        System.out.println(<span class="string">"删除所有数据库中的所有key："</span> + jedis.flushAll());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>对String操作的命令</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestString</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1、new Jedis对象即可</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"远程服务器ip地址"</span>, 端口号);</span><br><span class="line">        jedis.auth(<span class="string">"123456"</span>); <span class="comment">// redis登录密码，远程登录需要设置</span></span><br><span class="line">        <span class="comment">// jedis所有的命令就是我们之前学习的所有指令</span></span><br><span class="line"></span><br><span class="line">        jedis.flushDB();</span><br><span class="line">        System.out.println(<span class="string">"============================增加数据============================"</span>);</span><br><span class="line">        System.out.println(jedis.set(<span class="string">"key1"</span>, <span class="string">"value1"</span>));</span><br><span class="line">        System.out.println(jedis.set(<span class="string">"key2"</span>, <span class="string">"value2"</span>));</span><br><span class="line">        System.out.println(jedis.set(<span class="string">"key3"</span>, <span class="string">"value3"</span>));</span><br><span class="line">        System.out.println(<span class="string">"删除键key2："</span> + jedis.del(<span class="string">"key2"</span>));</span><br><span class="line">        System.out.println(<span class="string">"获取键key2："</span> + jedis.get(<span class="string">"key2"</span>));</span><br><span class="line">        System.out.println(<span class="string">"修改键key1"</span> + jedis.set(<span class="string">"key1"</span>, <span class="string">"value1Changed"</span>));</span><br><span class="line">        System.out.println(<span class="string">"获取key1的值："</span> + jedis.get(<span class="string">"key1"</span>));</span><br><span class="line">        System.out.println(<span class="string">"在key3后面加入值："</span> + jedis.append(<span class="string">"key3"</span>, <span class="string">"End"</span>));</span><br><span class="line">        System.out.println(<span class="string">"key3的值："</span> + jedis.get(<span class="string">"key3"</span>));</span><br><span class="line">        System.out.println(<span class="string">"增加多个键值对："</span> + jedis.mset(<span class="string">"key01"</span>, <span class="string">"value01"</span>, <span class="string">"key02"</span>, <span class="string">"value02"</span>, <span class="string">"key03"</span>, <span class="string">"value03"</span>));</span><br><span class="line">        System.out.println(<span class="string">"获取多个键值对："</span> + jedis.mget(<span class="string">"key01"</span>, <span class="string">"key02"</span>, <span class="string">"key03"</span>));</span><br><span class="line">        System.out.println(<span class="string">"获取多个键值对："</span> + jedis.mget(<span class="string">"key01"</span>, <span class="string">"key02"</span>, <span class="string">"key03"</span>, <span class="string">"key04"</span>));</span><br><span class="line">        System.out.println(<span class="string">"删除多个键值对："</span> + jedis.del(<span class="string">"key01"</span>, <span class="string">"key02"</span>));</span><br><span class="line">        System.out.println(<span class="string">"获取多个键值对："</span> + jedis.mget(<span class="string">"key01"</span>, <span class="string">"key02"</span>, <span class="string">"key03"</span>));</span><br><span class="line"></span><br><span class="line">        jedis.flushDB();</span><br><span class="line">        System.out.println(<span class="string">"============================新增键值对防止覆盖原先值============================"</span>);</span><br><span class="line">        System.out.println(jedis.setnx(<span class="string">"key1"</span>, <span class="string">"value1"</span>));</span><br><span class="line">        System.out.println(jedis.setnx(<span class="string">"key2"</span>, <span class="string">"value2"</span>));</span><br><span class="line">        System.out.println(jedis.setnx(<span class="string">"key2"</span>, <span class="string">"value2-new"</span>));</span><br><span class="line">        System.out.println(jedis.get(<span class="string">"key1"</span>));</span><br><span class="line">        System.out.println(jedis.get(<span class="string">"key2"</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"============================新增键值对并设置有效时间============================"</span>);</span><br><span class="line">        System.out.println(jedis.setex(<span class="string">"key3"</span>, <span class="number">2</span>, <span class="string">"value3"</span>));</span><br><span class="line">        System.out.println(jedis.get(<span class="string">"key3"</span>));</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(jedis.get(<span class="string">"key3"</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"============================获取原值，更新为新值============================"</span>);</span><br><span class="line">        System.out.println(jedis.getSet(<span class="string">"key2"</span>, <span class="string">"key2GetSet"</span>));</span><br><span class="line">        System.out.println(jedis.get(<span class="string">"key2"</span>));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">"获取key2的值的子串："</span> + jedis.getrange(<span class="string">"key2"</span>, <span class="number">2</span>, <span class="number">4</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>对List操作的命令</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestList</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1、new Jedis对象即可</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"远程服务器ip地址"</span>, 端口号);</span><br><span class="line">        jedis.auth(<span class="string">"123456"</span>); <span class="comment">// redis登录密码，远程登录需要设置</span></span><br><span class="line">        <span class="comment">// jedis所有的命令就是我们之前学习的所有指令</span></span><br><span class="line"></span><br><span class="line">        jedis.flushDB();</span><br><span class="line">        System.out.println(<span class="string">"============================添加一个list============================"</span>);</span><br><span class="line">        jedis.lpush(<span class="string">"collections"</span>, <span class="string">"ArrayList"</span>, <span class="string">"Vector"</span>, <span class="string">"Stack"</span>, <span class="string">"HashMap"</span>, <span class="string">"WeakHashMap"</span>, <span class="string">"LinkedHashMap"</span>);</span><br><span class="line">        jedis.lpush(<span class="string">"collections"</span>, <span class="string">"HashSet"</span>);</span><br><span class="line">        jedis.lpush(<span class="string">"collections"</span>, <span class="string">"TreeSet"</span>);</span><br><span class="line">        jedis.lpush(<span class="string">"collections"</span>, <span class="string">"TreeMap"</span>);</span><br><span class="line">        System.out.println(<span class="string">"collections的内容："</span> + jedis.lrange(<span class="string">"collections"</span>, <span class="number">0</span>, -<span class="number">1</span>)); <span class="comment">// -1代表倒数第一个元素，-2代表倒数第二个元素</span></span><br><span class="line">        System.out.println(<span class="string">"collections区间0-3的元素："</span> + jedis.lrange(<span class="string">"collections"</span>, <span class="number">0</span>, <span class="number">3</span>));</span><br><span class="line">        System.out.println(<span class="string">"========================================================"</span>);</span><br><span class="line">        System.out.println(<span class="string">"删除指定个数的元素："</span> + jedis.lrem(<span class="string">"colletions"</span>, <span class="number">2</span>, <span class="string">"HashMap"</span>));</span><br><span class="line">        System.out.println(<span class="string">"collections的内容："</span> + jedis.lrange(<span class="string">"collections"</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">"截取[0,3]区间的元素："</span> + jedis.ltrim(<span class="string">"collections"</span>, <span class="number">0</span>, <span class="number">3</span>));</span><br><span class="line">        System.out.println(<span class="string">"collections的内容："</span> + jedis.lrange(<span class="string">"collections"</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">"collections列表出栈（左端）："</span> + jedis.lpop(<span class="string">"collections"</span>));</span><br><span class="line">        System.out.println(<span class="string">"collections的内容："</span> + jedis.lrange(<span class="string">"collections"</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">"collections添加元素，从列表右端，与lpush对应："</span> + jedis.rpush(<span class="string">"collections"</span>, <span class="string">"EnumMap"</span>));</span><br><span class="line">        System.out.println(<span class="string">"collections的内容："</span> + jedis.lrange(<span class="string">"collections"</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">"collections列表出栈（右端）："</span> + jedis.rpop(<span class="string">"collections"</span>));</span><br><span class="line">        System.out.println(<span class="string">"collections的内容："</span> + jedis.lrange(<span class="string">"collections"</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">"修改collections指定下标1的内容："</span> + jedis.lset(<span class="string">"collections"</span>, <span class="number">1</span>, <span class="string">"LinkedArrayList"</span>));</span><br><span class="line">        System.out.println(<span class="string">"collections的内容："</span> + jedis.lrange(<span class="string">"collections"</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">        System.out.println(<span class="string">"========================================================"</span>);</span><br><span class="line">        System.out.println(<span class="string">"collections的长度："</span> + jedis.llen(<span class="string">"collections"</span>));</span><br><span class="line">        System.out.println(<span class="string">"获取collections下标为2的元素："</span> + jedis.lindex(<span class="string">"collections"</span>, <span class="number">2</span>));</span><br><span class="line">        System.out.println(<span class="string">"========================================================"</span>);</span><br><span class="line">        jedis.lpush(<span class="string">"sortedList"</span>, <span class="string">"3"</span>, <span class="string">"6"</span>, <span class="string">"2"</span>, <span class="string">"0"</span>, <span class="string">"7"</span>, <span class="string">"4"</span>);</span><br><span class="line">        System.out.println(<span class="string">"sortedList排序前："</span> + jedis.lrange(<span class="string">"sortedList"</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line">        System.out.println(jedis.sort(<span class="string">"sortedList"</span>));</span><br><span class="line">        System.out.println(<span class="string">"sortedList排序后："</span> + jedis.lrange(<span class="string">"sortedList"</span>, <span class="number">0</span>, -<span class="number">1</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>对Set的操作命令</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSet</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1、new Jedis对象即可</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"远程服务器ip地址"</span>, 端口号);</span><br><span class="line">        jedis.auth(<span class="string">"123456"</span>); <span class="comment">// redis登录密码，远程登录需要设置</span></span><br><span class="line">        <span class="comment">// jedis所有的命令就是我们之前学习的所有指令</span></span><br><span class="line"></span><br><span class="line">        jedis.flushDB();</span><br><span class="line">        System.out.println(<span class="string">"============================向集合中添加元素（不重复）============================"</span>);</span><br><span class="line">        System.out.println(jedis.sadd(<span class="string">"eleSet"</span>, <span class="string">"e1"</span>, <span class="string">"e2"</span>, <span class="string">"e4"</span>, <span class="string">"e3"</span>, <span class="string">"e0"</span>, <span class="string">"e8"</span>, <span class="string">"e7"</span>, <span class="string">"e5"</span>));</span><br><span class="line">        System.out.println(jedis.sadd(<span class="string">"eleSet"</span>, <span class="string">"e6"</span>));</span><br><span class="line">        System.out.println(jedis.sadd(<span class="string">"eleSet"</span>, <span class="string">"e6"</span>));</span><br><span class="line">        System.out.println(<span class="string">"eleSet的所有元素为："</span> + jedis.smembers(<span class="string">"eleSet"</span>));</span><br><span class="line">        System.out.println(<span class="string">"删除一个元素e0："</span> + jedis.srem(<span class="string">"eleSet"</span>, <span class="string">"e0"</span>));</span><br><span class="line">        System.out.println(<span class="string">"eleSet的所有元素为："</span> + jedis.smembers(<span class="string">"eleSet"</span>));</span><br><span class="line">        System.out.println(<span class="string">"删除两个元素e7和e6："</span> + jedis.srem(<span class="string">"eleSet"</span>, <span class="string">"e7"</span>, <span class="string">"e6"</span>));</span><br><span class="line">        System.out.println(<span class="string">"eleSet的所有元素为："</span> + jedis.smembers(<span class="string">"eleSet"</span>));</span><br><span class="line">        System.out.println(<span class="string">"随机的移除集合中的一个元素："</span> + jedis.spop(<span class="string">"eleSet"</span>));</span><br><span class="line">        System.out.println(<span class="string">"随机的移除集合中的一个元素："</span> + jedis.spop(<span class="string">"eleSet"</span>));</span><br><span class="line">        System.out.println(<span class="string">"eleSet的所有元素为："</span> + jedis.smembers(<span class="string">"eleSet"</span>));</span><br><span class="line">        System.out.println(<span class="string">"eleSet中包含元素的个数："</span> + jedis.scard(<span class="string">"eleSet"</span>));</span><br><span class="line">        System.out.println(<span class="string">"e3是否在eleSet中："</span> + jedis.sismember(<span class="string">"eleSet"</span>, <span class="string">"e3"</span>));</span><br><span class="line">        System.out.println(<span class="string">"e1是否在eleSet中："</span> + jedis.sismember(<span class="string">"eleSet"</span>, <span class="string">"e1"</span>));</span><br><span class="line">        System.out.println(<span class="string">"========================================================"</span>);</span><br><span class="line">        System.out.println(jedis.sadd(<span class="string">"eleSet1"</span>, <span class="string">"e1"</span>, <span class="string">"e2"</span>, <span class="string">"e4"</span>, <span class="string">"e3"</span>, <span class="string">"e0"</span>, <span class="string">"e8"</span>, <span class="string">"e7"</span>, <span class="string">"e5"</span>));</span><br><span class="line">        System.out.println(jedis.sadd(<span class="string">"eleSet2"</span>, <span class="string">"e1"</span>, <span class="string">"e2"</span>, <span class="string">"e4"</span>, <span class="string">"e3"</span>, <span class="string">"e0"</span>, <span class="string">"e8"</span>));</span><br><span class="line">        System.out.println(<span class="string">"将eleSet1中的e1移动到eleSet3中："</span> + jedis.smove(<span class="string">"eleSet1"</span>, <span class="string">"eleSet3"</span>, <span class="string">"e1"</span>));</span><br><span class="line">        System.out.println(<span class="string">"将eleSet1中的e2移动到eleSet3中："</span> + jedis.smove(<span class="string">"eleSet1"</span>, <span class="string">"eleSet3"</span>, <span class="string">"e2"</span>));</span><br><span class="line">        System.out.println(<span class="string">"eleSet1中的元素："</span> + jedis.smembers(<span class="string">"eleSet1"</span>));</span><br><span class="line">        System.out.println(<span class="string">"eleSet3中的元素："</span> + jedis.smembers(<span class="string">"eleSet3"</span>));</span><br><span class="line">        System.out.println(<span class="string">"============================集合运算============================"</span>);</span><br><span class="line">        System.out.println(<span class="string">"eleSet1中的元素："</span> + jedis.smembers(<span class="string">"eleSet1"</span>));</span><br><span class="line">        System.out.println(<span class="string">"eleSet2中的元素："</span> + jedis.smembers(<span class="string">"eleSet2"</span>));</span><br><span class="line">        System.out.println(<span class="string">"eleSet1和eleSet2的交集："</span> + jedis.sinter(<span class="string">"eleSet1"</span>, <span class="string">"eleSet2"</span>));</span><br><span class="line">        System.out.println(<span class="string">"eleSet1和eleSet2的并集："</span> + jedis.sunion(<span class="string">"eleSet1"</span>, <span class="string">"eleSet2"</span>));</span><br><span class="line">        System.out.println(<span class="string">"eleSet1和eleSet2的差集："</span> + jedis.sdiff(<span class="string">"eleSet1"</span>, <span class="string">"eleSet2"</span>)); <span class="comment">// eleSet1排除eleSet2的那部分</span></span><br><span class="line">        jedis.sinterstore(<span class="string">"eleSet4"</span>, <span class="string">"eleSet1"</span>, <span class="string">"eleSet2"</span>); <span class="comment">// 求交集并将交集保存到eleSet4集合中</span></span><br><span class="line">        System.out.println(<span class="string">"eleSet4中的元素："</span> + jedis.smembers(<span class="string">"eleSet4"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>对Hash的操作命令</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestHash</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 1、new Jedis对象即可</span></span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"远程服务器ip地址"</span>, 端口号);</span><br><span class="line">        jedis.auth(<span class="string">"123456"</span>); <span class="comment">// redis登录密码，远程登录需要设置</span></span><br><span class="line">        <span class="comment">// jedis所有的命令就是我们之前学习的所有指令</span></span><br><span class="line"></span><br><span class="line">        jedis.flushDB();</span><br><span class="line">        Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line">        map.put(<span class="string">"key1"</span>, <span class="string">"value1"</span>);</span><br><span class="line">        map.put(<span class="string">"key2"</span>, <span class="string">"value2"</span>);</span><br><span class="line">        map.put(<span class="string">"key3"</span>, <span class="string">"value3"</span>);</span><br><span class="line">        map.put(<span class="string">"key4"</span>, <span class="string">"value4"</span>);</span><br><span class="line">        <span class="comment">// 添加名称为hash(key)的hash元素</span></span><br><span class="line">        jedis.hmset(<span class="string">"hash"</span>, map);</span><br><span class="line">        <span class="comment">// 向名称为hash的hash中添加key为key5, value为value5的元素</span></span><br><span class="line">        jedis.hset(<span class="string">"hash"</span>, <span class="string">"key5"</span>, <span class="string">"value5"</span>);</span><br><span class="line">        System.out.println(<span class="string">"散列hash的所有键值对为："</span> + jedis.hgetAll(<span class="string">"hash"</span>)); <span class="comment">// return Map&lt;String, String&gt;</span></span><br><span class="line">        System.out.println(<span class="string">"散列hash的所有键为："</span> + jedis.hkeys(<span class="string">"hash"</span>)); <span class="comment">// return Set&lt;String&gt;</span></span><br><span class="line">        System.out.println(<span class="string">"散列hash的所有值为："</span> + jedis.hvals(<span class="string">"hash"</span>)); <span class="comment">// // return List&lt;String&gt;</span></span><br><span class="line">        System.out.println(<span class="string">"将key6保存的值加上一个整数，如果key6不存在，则添加key6："</span> + jedis.hincrBy(<span class="string">"hash"</span>, <span class="string">"key"</span>, <span class="number">6</span>));</span><br><span class="line">        System.out.println(<span class="string">"散列hash的所有键值对为："</span> + jedis.hgetAll(<span class="string">"hash"</span>));</span><br><span class="line">        System.out.println(<span class="string">"将key6保存的值加上一个整数，如果key6不存在，则添加key6："</span> + jedis.hincrBy(<span class="string">"hash"</span>, <span class="string">"key"</span>, <span class="number">3</span>));</span><br><span class="line">        System.out.println(<span class="string">"散列hash的所有键值对为："</span> + jedis.hgetAll(<span class="string">"hash"</span>));</span><br><span class="line">        System.out.println(<span class="string">"删除一个或者多个键值对："</span> + jedis.hdel(<span class="string">"hash"</span>, <span class="string">"key2"</span>));</span><br><span class="line">        System.out.println(<span class="string">"散列hash的所有键值对为："</span> + jedis.hgetAll(<span class="string">"hash"</span>));</span><br><span class="line">        System.out.println(<span class="string">"散列hash的所有键值对的个数："</span> + jedis.hlen(<span class="string">"hash"</span>));</span><br><span class="line">        System.out.println(<span class="string">"判断hash中是否存在key2："</span> + jedis.hexists(<span class="string">"hash"</span>, <span class="string">"key2"</span>));</span><br><span class="line">        System.out.println(<span class="string">"判断hash中是否存在key3："</span> + jedis.hexists(<span class="string">"hash"</span>, <span class="string">"key3"</span>));</span><br><span class="line">        System.out.println(<span class="string">"获取hash中的值："</span> + jedis.hmget(<span class="string">"hash"</span>, <span class="string">"key3"</span>));</span><br><span class="line">        System.out.println(<span class="string">"获取hash中的值："</span> + jedis.hmget(<span class="string">"hash"</span>, <span class="string">"key3"</span>, <span class="string">"key4"</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>事务操作</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.alibaba.fastjson.JSONObject;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Jedis;</span><br><span class="line"><span class="keyword">import</span> redis.clients.jedis.Transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestTX</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"远程服务器ip地址"</span>, 端口号);</span><br><span class="line">        jedis.auth(<span class="string">"123456"</span>);</span><br><span class="line"></span><br><span class="line">        jedis.flushDB();</span><br><span class="line"></span><br><span class="line">        JSONObject jsonObject = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        jsonObject.put(<span class="string">"hello"</span>, <span class="string">"world"</span>);</span><br><span class="line">        jsonObject.put(<span class="string">"name"</span>, <span class="string">"xiaoqiang"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 开启事务</span></span><br><span class="line">        Transaction multi = jedis.multi();</span><br><span class="line">        String result = jsonObject.toJSONString();</span><br><span class="line"><span class="comment">//        String watch = jedis.watch(result); // 监控result对象，实现乐观锁</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            multi.set(<span class="string">"user1"</span>, result);</span><br><span class="line">            multi.set(<span class="string">"user2"</span>, result);</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">1</span>/<span class="number">0</span>;  <span class="comment">// 代码抛出异常，事务执行失败</span></span><br><span class="line">            multi.exec(); <span class="comment">// 执行事务！</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            multi.discard(); <span class="comment">// 放弃事务</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(jedis.get(<span class="string">"user1"</span>));</span><br><span class="line">            System.out.println(jedis.get(<span class="string">"user2"</span>));</span><br><span class="line">            jedis.close(); <span class="comment">// 关闭连接，无论是否出现异常都会运行finally中的代码</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="SpringBoot整合"><a href="#SpringBoot整合" class="headerlink" title="SpringBoot整合"></a>SpringBoot整合</h1><p>SpringBoot操作数据：spring-data jpa jdbc mongodb redis！</p>
<p>SpringData也是和SpringBoot齐名的项目！</p>
<p>说明：在SpringBoot2.x之后，原来使用的jedis被替换为lettuce</p>
<p>jedis：采用直连，多个线程操作的话，是不安全的，如果想要避免不安全，使用jedis pool连接池！更像BIO模式</p>
<p>lettuce: 采用netty，实例可以在多个线程中进行共享，不存在线程不安全的情况！可以减少线程数量，更像NIO模式</p>
<p>源码分析：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright 2012-2019 the original author or authors.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the "License");</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      https://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an "AS IS" BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.springframework.boot.autoconfigure.data.redis;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.EnableAutoConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnClass;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Import;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisOperations;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.StringRedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> EnableAutoConfiguration Auto-configuration&#125; for Spring Data's Redis support.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Dave Syer</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Andy Wilkinson</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Christian Dupuis</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Christoph Strobl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Phillip Webb</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Eddú Meléndez</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Stephane Nicoll</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Marco Aust</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Mark Paluch</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.0.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@ConditionalOnClass</span>(RedisOperations<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">EnableConfigurationProperties</span>(<span class="title">RedisProperties</span>.<span class="title">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">Import</span>(</span>&#123; LettuceConnectionConfiguration<span class="class">.<span class="keyword">class</span>, <span class="title">JedisConnectionConfiguration</span>.<span class="title">class</span> &#125;)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">RedisAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean</span>(name = <span class="string">"redisTemplate"</span>) <span class="comment">// 我们可以自己定义一个redisTemplate来替换这个默认的</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">        <span class="comment">// 默认的RedisTemp没有过多的设置，redis对象都是需要序列化的！</span></span><br><span class="line">        <span class="comment">// 两个泛型都是Object类型，我们后面使用需要强制转换&lt;String, Object&gt;</span></span><br><span class="line">		RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">		template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">		<span class="keyword">return</span> template;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean</span> <span class="comment">// 由于String是redis中最常使用的类型，所以单独提出来了一个bean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> StringRedisTemplate <span class="title">stringRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">		StringRedisTemplate template = <span class="keyword">new</span> StringRedisTemplate();</span><br><span class="line">		template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">		<span class="keyword">return</span> template;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>整合测试</p>
</blockquote>
<p>1、导入依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--操作redis--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.junit.vintage<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit-vintage-engine<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2、配置连接</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SpringBoot 所有的配置类，都有一个自动配置类 RedisAutoConfiguration</span></span><br><span class="line"><span class="comment"># 自动配置类都会绑定一个properties配置文件   RedisProperties</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置redis</span></span><br><span class="line"><span class="meta">spring.redis.host</span>=<span class="string">服务器ip地址</span></span><br><span class="line"><span class="meta">spring.redis.port</span>=<span class="string">端口号</span></span><br><span class="line"><span class="meta">spring.redis.password</span>=<span class="string">redis登录密码</span></span><br></pre></td></tr></table></figure>
<p>3、测试</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yan;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnection;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Redis02SpringbootApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// redisTemplate 操作不同的数据类型，api和我们的指令是一样的</span></span><br><span class="line">        <span class="comment">// opsForValue 操作字符串 类似String</span></span><br><span class="line">        <span class="comment">// opsForList 操作list 类似List</span></span><br><span class="line">        <span class="comment">// opsForSet</span></span><br><span class="line">        <span class="comment">// opsForHash</span></span><br><span class="line">        <span class="comment">// opsForZset</span></span><br><span class="line">        <span class="comment">// opsForGeo</span></span><br><span class="line">        <span class="comment">// opsForHyperLogLog</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//除了基本的操作，常用的方法都可以直接使用redisTemplate操作，比如事务和基本的crud</span></span><br><span class="line">        <span class="comment">// 获取redis的连接对象</span></span><br><span class="line"><span class="comment">//        RedisConnection connection = redisTemplate.getConnectionFactory().getConnection();</span></span><br><span class="line"><span class="comment">//        connection.flushDb();</span></span><br><span class="line"></span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">"mykey1"</span>, <span class="string">"狂神说Java"</span>);</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">"mykey2"</span>, <span class="string">"kuangshen"</span>);</span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(<span class="string">"mykey1"</span>));</span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(<span class="string">"mykey2"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>redisTemplate默认的序列化配置：</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redisTemplate%E5%BA%8F%E5%88%97%E5%8C%96%E9%85%8D%E7%BD%AE.png" alt="redisTemplate序列化配置"></p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/JDK%E5%BA%8F%E5%88%97%E5%8C%96.png" alt="JDK序列化"></p>
<p>对象的保存需序列化：</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%AF%B9%E8%B1%A1%E7%9A%84%E4%BF%9D%E5%AD%98%E9%9C%80%E8%A6%81%E5%BA%8F%E5%88%97%E5%8C%96.png" alt="对象的保存需要序列化"></p>
<p>自定义RedisTemplate：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yan.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonAutoDetect;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.PropertyAccessor;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.Jackson2JsonRedisSerializer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.UnknownHostException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 编写我们自己的redisTemplate</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(<span class="string">"all"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">        <span class="comment">// 我们为了自己开发方便，一般直接使用&lt;String, Object&gt;</span></span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 配置具体的序列化方式</span></span><br><span class="line">        <span class="comment">// Json序列化配置</span></span><br><span class="line">        Jackson2JsonRedisSerializer&lt;Object&gt; jsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer&lt;Object&gt;(Object<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        <span class="comment">// String的序列化</span></span><br><span class="line">        StringRedisSerializer stringRedisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// key采用String的序列化方式</span></span><br><span class="line">        template.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        <span class="comment">// hash的key也采用String的序列化方式</span></span><br><span class="line">        template.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line">        <span class="comment">// value的序列化方式采用jackson</span></span><br><span class="line">        template.setValueSerializer(jsonRedisSerializer);</span><br><span class="line">        <span class="comment">// hash的value序列化方式采用jackson</span></span><br><span class="line">        template.setHashValueSerializer(jsonRedisSerializer);</span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="Redis-conf详解"><a href="#Redis-conf详解" class="headerlink" title="Redis.conf详解"></a>Redis.conf详解</h1><p>启动的时候，就通过配置文件启动的。</p>
<blockquote>
<p>单位</p>
</blockquote>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E7%9A%84%E5%8D%95%E4%BD%8D.png" alt="redis的单位"></p>
<p>1、配置文件 unit单位 对大小写不敏感！</p>
<blockquote>
<p>包含</p>
</blockquote>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%BB%84%E5%90%88%E5%A4%9A%E4%B8%AAconf%E6%96%87%E4%BB%B6.png" alt="组合多个conf文件"></p>
<p>包含多个配置文件</p>
<blockquote>
<p>网络</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">bind</span> 127.0.0.1 <span class="comment"># 绑定的ip</span></span><br><span class="line">protected-mode yes <span class="comment"># 保护模式</span></span><br><span class="line">port 6379 <span class="comment"># 端口设置</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>通用 GENERAL</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">daemonize yes <span class="comment"># 以守护进程的方式运行，默认是no，我们需要自己开启为yes</span></span><br><span class="line">pidfile /var/run/redis_6379.pid <span class="comment"># 如果以守护进程的方式运行，我们就需要指定一个pid文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志</span></span><br><span class="line"><span class="comment"># Specify the server verbosity level.</span></span><br><span class="line"><span class="comment"># This can be one of:</span></span><br><span class="line"><span class="comment"># debug (a lot of information, useful for development/testing)</span></span><br><span class="line"><span class="comment"># verbose (many rarely useful info, but not a mess like the debug level)</span></span><br><span class="line"><span class="comment"># notice (moderately verbose, what you want in production probably) 生产环境</span></span><br><span class="line"><span class="comment"># warning (only very important / critical messages are logged)</span></span><br><span class="line">loglevel notice</span><br><span class="line"></span><br><span class="line">logfile <span class="string">""</span>   <span class="comment"># 日志文件的保存位置</span></span><br><span class="line">databases 16 <span class="comment"># 数据库的数量，默认是16个数据库</span></span><br><span class="line">always-show-logo yes <span class="comment"># 是否显示logo</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>快照 SNAPSHOTTING</p>
</blockquote>
<p>持久化，在规定的时间内，执行了多少次操作，则会持久化到文件 .rdb .aof</p>
<p>redis是内存数据库，如果没有持久化，那么数据断电即失！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 900s内，有key进行了修改，则进行持久化操作</span></span><br><span class="line">save 900 1</span><br><span class="line"><span class="comment"># 300s内，至少有10个key进行了修改，则进行持久化操作</span></span><br><span class="line">save 300 10</span><br><span class="line"><span class="comment"># 60s内，至少有10000个key进行了修改，则进行持久化操作</span></span><br><span class="line">save 60 10000</span><br><span class="line"><span class="comment"># 我们之后学习持久化，会自己设置上面的值</span></span><br><span class="line"></span><br><span class="line">stop-writes-on-bgsave-error yes <span class="comment"># 持久化如果出错，是否还需要继续工作</span></span><br><span class="line"></span><br><span class="line">rdbcompression yes <span class="comment"># 是否压缩rdb文件，需要消耗一些cpu资源</span></span><br><span class="line"></span><br><span class="line">rdbchecksum yes <span class="comment"># 保存rdb文件的时候，计算校验和，校验文件完整性</span></span><br><span class="line"></span><br><span class="line">dir ./  <span class="comment"># rdb文件保存的目录</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>复制 REPLICATION，后面学习主从复制时，再进行学习</p>
<p>安全 SECURITY</p>
</blockquote>
<p>获取密码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis-cli</span></span><br><span class="line">config get requirepass</span><br></pre></td></tr></table></figure>
<p>设置redis的密码，默认是没有密码的！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">config <span class="built_in">set</span> requirepass 123456 <span class="comment"># 设置redis的密码</span></span><br><span class="line">auth 123456 <span class="comment"># 使用密码进行登录</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>限制 CLIENTS</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">maxclients 10000  <span class="comment"># 设置能连上redis-server的最大客户端数量</span></span><br><span class="line">maxmemory &lt;bytes&gt; <span class="comment"># redis 配置最大的内存容量</span></span><br><span class="line">maxmemory-policy noeviction <span class="comment"># 内存达到上限后的处理策略</span></span><br><span class="line"></span><br><span class="line">maxmemory-policy 六种方式</span><br><span class="line">1、volatile-lru：只对设置了过期时间的key进行LRU（默认值） </span><br><span class="line">2、allkeys-lru ： 删除lru算法的key   </span><br><span class="line">3、volatile-random：随机删除即将过期key   </span><br><span class="line">4、allkeys-random：随机删除   </span><br><span class="line">5、volatile-ttl ： 删除即将过期的   </span><br><span class="line">6、noeviction ： 永不过期，返回错误</span><br></pre></td></tr></table></figure>
<blockquote>
<p>APPEND ONLY MODE模式 aof配置</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">appendonly no <span class="comment"># 默认是不开启aof模式的，默认使用rdb方式持久化，在大部分情况下，rdb完全够用！</span></span><br><span class="line">appendfilename <span class="string">"appendonly.aof"</span> <span class="comment"># 持久化文件的名字</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># appendfsync always  # 每次修改都会sync，消耗性能</span></span><br><span class="line">appendfsync everysec  <span class="comment"># 每秒执行一次 sync，可能会丢失这1s的数据</span></span><br><span class="line"><span class="comment"># appendfsync no      # 不执行sync，这个时候操作系统自己实现同步数据，速度最快！</span></span><br></pre></td></tr></table></figure>
<h1 id="Redis持久化"><a href="#Redis持久化" class="headerlink" title="Redis持久化"></a>Redis持久化</h1><p>面试和工作，持久化都是重点！</p>
<p>Redis内存数据库，如果不将内存中的数据保存到磁盘，服务器进程退出，服务器中的数据库状态也会消失。所以Redis提供了持久化功能！</p>
<h2 id="RDB（Redis-DataBase）"><a href="#RDB（Redis-DataBase）" class="headerlink" title="RDB（Redis DataBase）"></a>RDB（Redis DataBase）</h2><blockquote>
<p>什么是RDB</p>
</blockquote>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/rdb.png" alt="rdb"></p>
<p>在指定时间间隔内将内存中的数据集快照写入磁盘，也就是行话讲的Snapshot快照，数据库恢复时，直接将快照文件读入内存中。</p>
<p>Redis会单独创建（fork）一个子进程来持久化，会将数据写入到一个临时文件中，待持久化过程结束，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程不进行任何IO操作。这就确保了极高的性能。如果需要进行大规模数据的恢复，且对数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加高效。RDB的缺点是最后一次持久化后的数据可能丢失。</p>
<p>默认是采用RDB持久化，一般情况下不需要修改这个配置！</p>
<p>在生产环境一般会对dump.rdb文件进行备份</p>
<p><strong>rdb保存的文件是 dump.rdb</strong></p>
<blockquote>
<p>在配置文件的快照（SNAPSHOTTING）中进行配置</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># The filename where to dump the DB</span></span><br><span class="line">dbfilename dump.rdb <span class="comment"># rdb保存的文件名</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># save 900 1</span></span><br><span class="line"><span class="comment"># save 300 10</span></span><br><span class="line"><span class="comment"># save 60 10000</span></span><br><span class="line">save 60 5 <span class="comment"># 测试：只要60s内修改了5次key，就会触发rdb操作</span></span><br></pre></td></tr></table></figure>
<p>1、save的规则满足的情况下，会自动生成dump.rdb文件</p>
<p>2、执行flushall命令，也会自动生成dump.rdb文件</p>
<p>3、退出redis，也会生成dump.rdb文件！</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/rdb%E6%96%87%E4%BB%B6.png" alt="rdb文件"></p>
<blockquote>
<p>如何恢复rdb文件</p>
</blockquote>
<p>1、只需要将rdb文件放在redis启动目录就行了，redis启动的时候会自动检查dump.rdb，并恢复其中的数据！</p>
<p>2、查看配置文件目录：</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%9F%A5%E7%9C%8B%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95.png" alt="查看配置文件目录"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; config get dir</span><br><span class="line">1) <span class="string">"dir"</span></span><br><span class="line">2) <span class="string">"/usr/local/bin/myredisconifg"</span> <span class="comment"># 如果在这个目录下存在dump.rdb文件，启动就会自动恢复其中的数据</span></span><br></pre></td></tr></table></figure>
<p><strong>优点：</strong></p>
<p>1、适合大规模的数据恢复！dump.rdb</p>
<p>2、对数据完整性要求不高</p>
<p><strong>缺点：</strong></p>
<p>1、需要一定的时间间隔进行操作！如果redis意外宕机了，最后一次修改的数据就没了！</p>
<p>2、fork进程的时候会占用一定的内存空间！</p>
<h1 id="AOF（Append-Only-File）"><a href="#AOF（Append-Only-File）" class="headerlink" title="AOF（Append Only File）"></a>AOF（Append Only File）</h1><p>将我们的所有命令都记录下来，history，恢复的时候就把这个文件中的命令全部执行一遍！</p>
<blockquote>
<p>是什么</p>
</blockquote>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/aof.png" alt="aof"></p>
<p>以日志的新式来记录每个写操作，将Redis执行过的所有指令记录下来（读操作不记录）只许追加文件但不能改写文件，redis启动之初会读取该文件重新构建数据，换言之，redis重启的话，就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作。</p>
<p><strong>AOF保存的是appendonly.aof文件</strong></p>
<p>配置文件中配置AOF的部分</p>
<blockquote>
<p> APPEND ONLY MODE</p>
</blockquote>
<p>AOF默认是不开启的，我们需要手动开启</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">appendonly yes</span><br></pre></td></tr></table></figure>
<p>重启服务，AOF配置就生效了</p>
<p><strong>如果appendonly.aof文件有错位，redis服务是启动不了的，我们需要修复这个aof文件</strong></p>
<p>redis给我们提供了一个工具：<code>redis-check-aof</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-check-aof --fix appendonly.aof</span><br></pre></td></tr></table></figure>
<p><code>redis-check-aof</code>会删除错误的命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">appendonly no <span class="comment"># 默认是不开启aof模式的，默认使用rdb方式持久化，在大部分情况下，rdb完全够用！</span></span><br><span class="line">appendfilename <span class="string">"appendonly.aof"</span> <span class="comment"># 持久化文件的名字</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># appendfsync always  # 每次修改都会sync，消耗性能</span></span><br><span class="line">appendfsync everysec  <span class="comment"># 每秒执行一次 sync，可能会丢失这1s的数据</span></span><br><span class="line"><span class="comment"># appendfsync no      # 不执行sync，这个时候操作系统自己实现同步数据，速度最快！</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># rewrite 重写</span></span><br></pre></td></tr></table></figure>
<p>aof默认就是文件的无限追加，文件会越来越大！</p>
<p>如果aof文件大于64mb，会fork一个新进程来将我们的文件进行重写！</p>
<p><strong>优点：</strong> </p>
<p>1、每次修改都同步，文件的完整性会更好！</p>
<p>2、每秒同步一次，可能会丢失一秒的数据</p>
<p>3、不同步，效率最高！</p>
<p><strong>缺点：</strong></p>
<p>1、相对数据文件来说，aof远远大于rdb，修复速度也比rdb慢！</p>
<p>2、aof运行效率也比rdb慢，redis默认配置是rdb持久化！</p>
<h1 id="Redis发布订阅"><a href="#Redis发布订阅" class="headerlink" title="Redis发布订阅"></a>Redis发布订阅</h1><p>Redis发布订阅（pub/sub）是一种<strong>消息通信模式</strong>：发送者（pub）发送消息，订阅者（sub）接收消息。微信、微博、关注系统！</p>
<p>Redis客户端可以订阅任意数量的频道。</p>
<p>订阅/发布消息图：</p>
<p>三个角色：</p>
<ul>
<li>消息发送者</li>
<li>频道</li>
<li>消息订阅者</li>
</ul>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85.png" alt="redis发布订阅"></p>
<p>下图展示了频道 channel1 ， 以及订阅这个频道的三个客户端 —— client2 、 client5 和 client1 之间的关系：</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/pubsub1.png" alt="pubsub1"></p>
<p>当有新消息通过 PUBLISH 命令发送给频道 channel1 时， 这个消息就会被发送给订阅它的三个客户端：</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/pubsub2.png" alt="pubsub2"></p>
<blockquote>
<p>命令</p>
</blockquote>
<p>这些命令被广泛用于构建即时通信应用，比如网络聊天室（charroom）和实时广播、实时提醒等。</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">序号</th>
<th style="text-align:left">命令及描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">1</td>
<td style="text-align:left"><a href="https://www.runoob.com/redis/pub-sub-psubscribe.html" target="_blank" rel="noopener">PSUBSCRIBE pattern [pattern …]</a> 订阅一个或多个符合给定模式的频道。</td>
</tr>
<tr>
<td style="text-align:left">2</td>
<td style="text-align:left"><a href="https://www.runoob.com/redis/pub-sub-pubsub.html" target="_blank" rel="noopener">PUBSUB subcommand [argument [argument …]]</a> 查看订阅与发布系统状态。</td>
</tr>
<tr>
<td style="text-align:left">3</td>
<td style="text-align:left"><a href="https://www.runoob.com/redis/pub-sub-publish.html" target="_blank" rel="noopener">PUBLISH channel message</a> 将信息发送到指定的频道。</td>
</tr>
<tr>
<td style="text-align:left">4</td>
<td style="text-align:left"><a href="https://www.runoob.com/redis/pub-sub-punsubscribe.html" target="_blank" rel="noopener">PUNSUBSCRIBE [pattern [pattern …]]</a> 退订所有给定模式的频道。</td>
</tr>
<tr>
<td style="text-align:left">5</td>
<td style="text-align:left"><a href="https://www.runoob.com/redis/pub-sub-subscribe.html" target="_blank" rel="noopener">SUBSCRIBE channel [channel …]</a> 订阅给定的一个或多个频道的信息。</td>
</tr>
<tr>
<td style="text-align:left">6</td>
<td style="text-align:left"><a href="https://www.runoob.com/redis/pub-sub-unsubscribe.html" target="_blank" rel="noopener">UNSUBSCRIBE [channel [channel …]]</a> 指退订给定的频道。</td>
</tr>
</tbody>
</table>
</div>
<blockquote>
<p>测试</p>
</blockquote>
<p>订阅者：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SUBSCRIBE mychannel           <span class="comment"># 订阅mychannel频道</span></span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) <span class="string">"subscribe"</span></span><br><span class="line">2) <span class="string">"mychannel"</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br><span class="line"><span class="comment"># 等待读取推送的信息</span></span><br><span class="line">1) <span class="string">"message"</span>        <span class="comment"># 信息</span></span><br><span class="line">2) <span class="string">"mychannel"</span>		<span class="comment"># 频道名</span></span><br><span class="line">3) <span class="string">"hello world!"</span>	<span class="comment"># 信息具体内容</span></span><br></pre></td></tr></table></figure>
<p>发布者：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; PUBLISH mychannel <span class="string">"hello world!"</span> <span class="comment"># 发布者向mychannel频道发送"hello world!"消息</span></span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>
<blockquote>
<p>原理</p>
</blockquote>
<p>Redis是使用C实现的，通过分析Redis源码里的pubsub.c文件，了解发布和订阅机制的底层实现，借此加深对Redis的理解。</p>
<p>Redis通过publish、subscribe和psubscribe等命令实现发布和订阅功能。</p>
<p>通过subscribe命令订阅某频道后，redis-server里维护一个字典，字典的键就是一个个的channel，而字典的值则是一个链表，链表中保存了所有订阅这个channel的客户端。subscribe命令的关键，就是将客户端添加到给定的channel的订阅链表中。</p>
<p>通过publish命令向订阅者发送消息，redis-server会使用给定的频道作为键，在它所维护的channel字典中查找记录了订阅这个频道的所有客户端的链表，遍历这个链表，将消息发布给所有的订阅者。</p>
<p>Pub/Sub从字面上理解就是发布（Publish）与订阅（Subscribe），在Redis中，可以设定对某个key值进行消息发布及消息订阅，当一个key值上进行了消息发布后，所有订阅它的客户端都会收到相应的消息。这一功能最明显的用法就是用作实时消息系统，比如普通的即时聊天，群聊等功能。</p>
<p><strong>使用场景：</strong></p>
<p>1、实时消息系统！</p>
<p>2、实时聊天！（频道当作聊天室，将消息回显给所有人即可）</p>
<p>3、订阅，关注系统都是可以的！</p>
<p>稍微复杂的场景会使用消息中间件：MQ（消息队列）</p>
<h1 id="Redis主从复制"><a href="#Redis主从复制" class="headerlink" title="Redis主从复制"></a>Redis主从复制</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器，前者称为主节点（master/leader），后者称为从节点（slave/follower），<strong>数据的复制是单向的，只能从主节点到从节点</strong>。Master以写为主，Slave以读为主。</p>
<p><strong>默认情况下，每台Redis服务器都是主节点；</strong>且一个主节点可以有多个从节点（或没有从节点），但一个从节点只能有一个主节点。</p>
<p>主从复制的作用主要包括：</p>
<p>1、数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式。</p>
<p>2、故障恢复：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复；实际上是一种服务的冗余。</p>
<p>3、负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务（即写Redis数据时应用连接主节点，读Redis数据时应用连接从节点），分担服务器负载；尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高Redis服务器的并发量。</p>
<p>4、高可用基石：除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制时Redis高可用的基础。</p>
<p>一般来说，要将Redis应用到工程项目中，只使用一台Redis是万万不能的，原因入下：</p>
<p>1、从结构上，单个Redis服务器会发生单点故障，并且一台服务器需要处理所有的请求负载，压力较大；</p>
<p>2、从容量上，单个Redis服务器内存容量有限，就算一台Redis服务器内存容量由256GB，也不能将所有内存用作Redis存储内存，一般来说，<strong>单台Redis最大使用内存不应该超过20GB</strong>。</p>
<p>电商网站上的商品，一般都是一次上传，无数次浏览的，说专业点也就是“读多少写”。</p>
<p>对于这种场景，我们可以使用如下这种架构：</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84.png" alt="redis集群架构"></p>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><h3 id="只配置从结点，不用配置主结点！"><a href="#只配置从结点，不用配置主结点！" class="headerlink" title="只配置从结点，不用配置主结点！"></a>只配置从结点，不用配置主结点！</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info replication <span class="comment"># 查看当前结点的信息</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master                      <span class="comment"># 角色 master</span></span><br><span class="line">connected_slaves:0				 <span class="comment"># 没有从结点</span></span><br><span class="line">master_replid:4b845ff597476841e7e032fa47e7851d6adb63ab</span><br><span class="line">master_replid2:0000000000000000000000000000000000000000</span><br><span class="line">master_repl_offset:0</span><br><span class="line">second_repl_offset:-1</span><br><span class="line">repl_backlog_active:0</span><br><span class="line">repl_backlog_size:1048576</span><br><span class="line">repl_backlog_first_byte_offset:0</span><br><span class="line">repl_backlog_histlen:0</span><br></pre></td></tr></table></figure>
<h3 id="复制三个配置文件，修改对应的信息"><a href="#复制三个配置文件，修改对应的信息" class="headerlink" title="复制三个配置文件，修改对应的信息"></a>复制三个配置文件，修改对应的信息</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cp redis.conf redis79.conf</span><br><span class="line">cp redis.conf redis80.conf</span><br><span class="line">cp redis.conf redis81.conf</span><br></pre></td></tr></table></figure>
<ul>
<li>端口</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">port 6381</span><br></pre></td></tr></table></figure>
<ul>
<li>pidfile 守护进程名</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pidfile /var/run/redis_6381.pid</span><br></pre></td></tr></table></figure>
<ul>
<li>logfile log日志名</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">logfile <span class="string">"6381.log"</span></span><br></pre></td></tr></table></figure>
<ul>
<li>dbfilename rdb文件名</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dbfilename dump6381.rdb</span><br></pre></td></tr></table></figure>
<ul>
<li>masterauth 配置主节点密码</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">masterauth 123456</span><br></pre></td></tr></table></figure>
<h3 id="开三个终端启动对应的redis服务"><a href="#开三个终端启动对应的redis服务" class="headerlink" title="开三个终端启动对应的redis服务"></a>开三个终端启动对应的redis服务</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-server redis79.conf</span><br><span class="line">redis-server redis80.conf</span><br><span class="line">redis-server redis81.conf</span><br></pre></td></tr></table></figure>
<h3 id="查看redis进程"><a href="#查看redis进程" class="headerlink" title="查看redis进程"></a>查看redis进程</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep redis</span><br></pre></td></tr></table></figure>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/redis%E8%BF%9B%E7%A8%8B.png" alt="redis进程"></p>
<h2 id="一主二从"><a href="#一主二从" class="headerlink" title="一主二从"></a>一主二从</h2><p><strong>默认情况下，每个结点都是主结点</strong>，一般情况下只用配置从机就好了。</p>
<p>一主（6379）二从（6380、6381）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -p 6379 <span class="comment"># 开启对应的客户端</span></span><br><span class="line">redis-cli -p 6380</span><br><span class="line">redis-cli -p 6381</span><br></pre></td></tr></table></figure>
<p>在6380和6381两个从结点中进行配置，在客户端中输入如下命令：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slaveof 127.0.0.1 6379 <span class="comment"># slaveof 主结点IP地址 主结点端口号</span></span><br></pre></td></tr></table></figure>
<p>如果搭建成功，主节点上可以看到两个从节点信息：</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA%E6%88%90%E5%8A%9F.png" alt="集群搭建成功"></p>
<p>真实的主从配置应该在配置文件中配置，这样话是永久配置，我们这里使用的是命令，是暂时的配置（重启服务后，会变成主机），配置从节点的配置文件，配置REPLICATION部分。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># REPLICATION部分</span></span><br><span class="line">replicaof &lt;masterip&gt; &lt;masterport&gt; <span class="comment"># 主节点IP 主节点端口号</span></span><br><span class="line">masterauth &lt;master-password&gt; <span class="comment"># 主节点密码</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>细节</p>
</blockquote>
<p>主结点负责写（也可以读），从结点只能读！主结点中的所有信息，都会被从结点保存。</p>
<p>主结点写：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; keys *</span><br><span class="line">(empty array)</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line"><span class="string">"v1"</span></span><br></pre></td></tr></table></figure>
<p>从结点只能读：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6381&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">(error) READONLY You can<span class="string">'t write against a read only replica.</span></span><br><span class="line"><span class="string">127.0.0.1:6381&gt; get k1</span></span><br><span class="line"><span class="string">"v1"</span></span><br><span class="line"><span class="string">127.0.0.1:6381&gt; keys *</span></span><br><span class="line"><span class="string">1) "k1"</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>测试：主节点断开连接，从结点依旧连接到主节点的，但是没有写操作了，这时，主机如果回复连接，从机依旧可以直接获取到主机写的内容！</p>
</blockquote>
<p>如果使用命令行配置主从，服务重启后，该结点会变回主机（默认配置），只要变为从机，该节点就能获取到主机中的数据。</p>
<blockquote>
<p>复制原理</p>
</blockquote>
<p>Slave启动成功连接到Master后会发送一个sync同步命令</p>
<p>Master接到命令，启动后台的存盘进程，同时收集所有接收到的用于修改数据集的命令，在后台进程执行完毕后，<strong>Master将传送整个数据文件到Slave，并完成一次完全同步</strong>。</p>
<p><strong>全量复制</strong>：Slave服务在接收到数据库文件数据后（Slave连接Master后），将其存盘并加载到内存中。</p>
<p><strong>增量复制</strong>：Master继续将新的所有收集到的修改命令（连接后主机新增的数据）依次传给Slave，完成同步。</p>
<p>但是只要重新连接Master，一次完全同步（全量复制）将被自动执行。</p>
<blockquote>
<p>层层链路</p>
</blockquote>
<p>上一个Master连接下一个Slave</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%B1%82%E5%B1%82%E9%93%BE%E8%B7%AF.png" alt="层层链路"></p>
<p>这种模式也可以完成主从复制！</p>
<blockquote>
<p>如果没有老大了，这个时候需要手动选择一个老大！</p>
</blockquote>
<p>如果主机断开连接，我们可以使用<code>slaveof no one</code>让自己变成主节点！其他的节点就可以手动连接到最新的这个主节点（手动）！如果这个时候老大恢复了，这个谋权篡位的小弟也不会变成老大小弟。</p>
<h1 id="哨兵模式"><a href="#哨兵模式" class="headerlink" title="哨兵模式"></a>哨兵模式</h1><p>（自动选举老大的模式）</p>
<blockquote>
<p>概述</p>
</blockquote>
<p>主从切换技术的方法是：当主服务器宕机后，需要手动把一台服务器切换为主服务器，这就需要人工干预，费时费力，还会造成一段时间内服务不可用。这不是一种推荐的方式，更多时候，我们优先考虑哨兵模式。Redis从2.8开始正式提供了Sentinel（哨兵）架构来解决该问题。</p>
<p>谋权篡位的自动版，后台能够监控主机是否故障，如果故障了根据投票数<strong>自动将从库转换为主库</strong>。</p>
<p>哨兵模式是一种特殊的模式，首先Redis提供了哨兵的命令，哨兵是一个独立的进程，作为进程，他会独立运行，其原理是<strong>哨兵通过发送命令，等待Redis服务器响应，从而监控运行多个Redis实例。</strong></p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F.png" alt="哨兵模式"></p>
<p>这里的哨兵有两个作用</p>
<ul>
<li><p>通过发送命令，让Redis服务器返回监控其运行状态，包括主服务器和从服务器。</p>
</li>
<li><p>当哨兵检测到master宕机，会自动将Slave切换成Master，然后通过<strong>发布订阅模式</strong>通知其他的从服务器，修改配置文件，让它们切换主机。</p>
</li>
</ul>
<p>然而一个哨兵进程对Redis服务器进行监控，可能会出现问题，为此，我们可以使用多个哨兵进行监控。各个哨兵之间还会进行监控。这样就形成了多哨兵模式。</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%A4%9A%E5%93%A8%E5%85%B5%E6%A8%A1%E5%BC%8F.png" alt="多哨兵模式"></p>
<p>假设主服务器宕机，哨兵1先检测到这个结果，系统并不会马上进行failover（重新选举）过程，仅仅是哨兵1主观的认为主服务器不可用，这个现象称为<strong>主观下线</strong>。当后面的哨兵也检测到主服务器不可用，并且数量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行failover[故障转移]操作。切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为<strong>客观下线</strong>。</p>
<blockquote>
<p>测试</p>
</blockquote>
<p>我们目前的状态是一主二从！</p>
<p>1、配置哨兵配置文件：sentinel.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sentinel monitor 被监控的名称 主机IP地址 主机端口号 有多少个哨兵认为master挂了，master才算真的挂了</span></span><br><span class="line">sentinel monitor myredis 127.0.0.1 6379 1</span><br></pre></td></tr></table></figure>
<p>2、启动哨兵！</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">root@be31dcbb77f1:/usr/<span class="built_in">local</span>/bin/myredisconifg<span class="comment"># redis-sentinel sentinel.conf</span></span><br><span class="line">1861:X 31 Aug 2020 15:41:11.175 <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line">1861:X 31 Aug 2020 15:41:11.175 <span class="comment"># Redis version=6.0.6, bits=64, commit=00000000, modified=0, pid=1861, just started</span></span><br><span class="line">1861:X 31 Aug 2020 15:41:11.175 <span class="comment"># Configuration loaded</span></span><br><span class="line">1861:X 31 Aug 2020 15:41:11.177 * Increased maximum number of open files to 10032 (it was originally <span class="built_in">set</span> to 1024).</span><br><span class="line">                _._</span><br><span class="line">           _.-``__ <span class="string">''</span>-._</span><br><span class="line">      _.-``    `.  `_.  <span class="string">''</span>-._           Redis 6.0.6 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ <span class="string">''</span>-._</span><br><span class="line"> (    <span class="string">'      ,       .-`  | `,    )     Running in sentinel mode</span></span><br><span class="line"><span class="string"> |`-._`-...-` __...-.``-._|'</span>` _.-<span class="string">'|     Port: 26379</span></span><br><span class="line"><span class="string"> |    `-._   `._    /     _.-'</span>    |     PID: 1861</span><br><span class="line">  `-._    `-._  `-./  _.-<span class="string">'    _.-'</span></span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|</span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-'</span>_.-<span class="string">'    |           http://redis.io</span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-'</span>_.-<span class="string">'    _.-'</span></span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|</span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-'</span>_.-<span class="string">'    |</span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-'</span>_.-<span class="string">'    _.-'</span></span><br><span class="line">      `-._    `-.__.-<span class="string">'    _.-'</span></span><br><span class="line">          `-._        _.-<span class="string">'</span></span><br><span class="line"><span class="string">              `-.__.-'</span></span><br><span class="line"></span><br><span class="line">1861:X 31 Aug 2020 15:41:11.178 <span class="comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></span><br><span class="line">1861:X 31 Aug 2020 15:41:11.194 <span class="comment"># Sentinel ID is cb25777acee82df55ddae3f8cae1e39ee9e70d21</span></span><br><span class="line">1861:X 31 Aug 2020 15:41:11.195 <span class="comment"># +monitor master myredis 127.0.0.1 6379 quorum 1</span></span><br><span class="line">1861:X 31 Aug 2020 15:41:41.233 <span class="comment"># +sdown master myredis 127.0.0.1 6379</span></span><br><span class="line">1861:X 31 Aug 2020 15:41:41.233 <span class="comment"># +odown master myredis 127.0.0.1 6379 #quorum 1/1</span></span><br><span class="line">1861:X 31 Aug 2020 15:41:41.233 <span class="comment"># +new-epoch 1</span></span><br><span class="line">1861:X 31 Aug 2020 15:41:41.233 <span class="comment"># +try-failover master myredis 127.0.0.1 6379</span></span><br><span class="line">1861:X 31 Aug 2020 15:41:41.236 <span class="comment"># +vote-for-leader cb25777acee82df55ddae3f8cae1e39ee9e70d21 1</span></span><br><span class="line">1861:X 31 Aug 2020 15:41:41.236 <span class="comment"># +elected-leader master myredis 127.0.0.1 6379</span></span><br><span class="line">1861:X 31 Aug 2020 15:41:41.236 <span class="comment"># +failover-state-select-slave master myredis 127.0.0.1 6379</span></span><br><span class="line">1861:X 31 Aug 2020 15:41:41.291 <span class="comment"># -failover-abort-no-good-slave master myredis 127.0.0.1 6379</span></span><br><span class="line">1861:X 31 Aug 2020 15:41:41.374 <span class="comment"># Next failover delay: I will not start a failover before Mon Aug 31 15:47:41 2020</span></span><br></pre></td></tr></table></figure>
<p>如果Master节点断开了，这个时候就会在从机中随机选择一个服务器（这里有一个投票算法！）</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%93%A8%E5%85%B5%E9%80%89%E7%9A%84%E6%96%B0%E4%B8%BB%E8%8A%82%E7%82%B9.png" alt="哨兵选的新主节点"></p>
<p>哨兵日志：</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%93%A8%E5%85%B5%E6%97%A5%E5%BF%97.png" alt="哨兵日志"></p>
<p>如果主机此时回来了，只能归并到新的主机下，当作从机，这就是哨兵模式的规则！</p>
<blockquote>
<p>哨兵模式</p>
</blockquote>
<p>优点：</p>
<p>1、哨兵集群，基于主从复制模式，所有的主从配置优点，它全有</p>
<p>2、主从可以切换，故障可以转移，系统的可用性就会更好</p>
<p>3、哨兵模式就是主从模式的升级，手动到自动，更加健壮！</p>
<p>缺点：</p>
<p>1、Redis不好在线扩容，集群容量一旦到达上限，在线扩容会十分麻烦！</p>
<p>2、实现哨兵模式的配置其实是很麻烦的，里面有很多选择！</p>
<blockquote>
<p>哨兵模式的全部配置！</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Example sentinel.conf</span></span><br><span class="line"> </span><br><span class="line"><span class="comment"># 哨兵sentinel实例运行的端口 默认26379；如果有哨兵集群，我们还需要配置每个哨兵的端口</span></span><br><span class="line">port 26379</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 哨兵sentinel的工作目录</span></span><br><span class="line">dir /tmp</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 哨兵sentinel监控的redis主节点的 ip port </span></span><br><span class="line"><span class="comment"># master-name  可以自己命名的主节点名字 只能由字母A-z、数字0-9 、这三个字符".-_"组成。</span></span><br><span class="line"><span class="comment"># quorum 当这些quorum个数sentinel哨兵认为master主节点失联 那么这时 客观上认为主节点失联了</span></span><br><span class="line"><span class="comment"># sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span></span><br><span class="line">sentinel monitor mymaster 127.0.0.1 6379 2</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 当在Redis实例中开启了requirepass foobared 授权密码 这样所有连接Redis实例的客户端都要提供密码</span></span><br><span class="line"><span class="comment"># 设置哨兵sentinel 连接主从的密码 注意必须为主从设置一样的验证密码</span></span><br><span class="line"><span class="comment"># sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span></span><br><span class="line">sentinel auth-pass mymaster MySUPER--secret-0123passw0rd</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 指定多少毫秒之后 主节点没有应答哨兵sentinel 此时 哨兵主观上认为主节点下线 默认30秒</span></span><br><span class="line"><span class="comment"># sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line">sentinel down-after-milliseconds mymaster 30000</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 这个配置项指定了在发生failover主备切换时最多可以有多少个slave同时对新的master进行 同步，</span></span><br><span class="line">这个数字越小，完成failover所需的时间就越长，</span><br><span class="line">但是如果这个数字越大，就意味着越 多的slave因为replication而不可用。</span><br><span class="line">可以通过将这个值设为 1 来保证每次只有一个slave 处于不能处理命令请求的状态。</span><br><span class="line"><span class="comment"># sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt;</span></span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment"># 故障转移的超时时间 failover-timeout 可以用在以下这些方面： </span></span><br><span class="line"><span class="comment">#1. 同一个sentinel对同一个master两次failover之间的间隔时间。</span></span><br><span class="line"><span class="comment">#2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。</span></span><br><span class="line"><span class="comment">#3.当想要取消一个正在进行的failover所需要的时间。  </span></span><br><span class="line"><span class="comment">#4.当进行failover时，配置所有slaves指向新的master所需的最大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了</span></span><br><span class="line"><span class="comment"># 默认三分钟</span></span><br><span class="line"><span class="comment"># sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line">sentinel failover-timeout mymaster 180000</span><br><span class="line"> </span><br><span class="line"><span class="comment"># SCRIPTS EXECUTION</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知相关人员。</span></span><br><span class="line"><span class="comment">#对于脚本的运行结果有以下规则：</span></span><br><span class="line"><span class="comment">#若脚本执行后返回1，那么该脚本稍后将会被再次执行，重复次数目前默认为10</span></span><br><span class="line"><span class="comment">#若脚本执行后返回2，或者比2更高的一个返回值，脚本将不会重复执行。</span></span><br><span class="line"><span class="comment">#如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为1时的行为相同。</span></span><br><span class="line"><span class="comment">#一个脚本的最大执行时间为60s，如果超过这个时间，脚本将会被一个SIGKILL信号终止，之后重新执行。</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#通知型脚本:当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等等），将会去调用这个脚本，</span></span><br><span class="line">这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信息。调用该脚本时，将传给脚本两个参数，</span><br><span class="line">一个是事件的类型，</span><br><span class="line">一个是事件的描述。</span><br><span class="line">如果sentinel.conf配置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则sentinel无法正常启动成功。</span><br><span class="line"><span class="comment">#通知脚本</span></span><br><span class="line"><span class="comment"># sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line">  sentinel notification-script mymaster /var/redis/notify.sh</span><br><span class="line"> </span><br><span class="line"><span class="comment"># 客户端重新配置主节点参数脚本</span></span><br><span class="line"><span class="comment"># 当一个master由于failover而发生改变时，这个脚本将会被调用，通知相关的客户端关于master地址已经发生改变的信息。</span></span><br><span class="line"><span class="comment"># 以下参数将会在调用脚本时传给脚本:</span></span><br><span class="line"><span class="comment"># &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;</span></span><br><span class="line"><span class="comment"># 目前&lt;state&gt;总是“failover”,</span></span><br><span class="line"><span class="comment"># &lt;role&gt;是“leader”或者“observer”中的一个。 </span></span><br><span class="line"><span class="comment"># 参数 from-ip, from-port, to-ip, to-port是用来和旧的master和新的master(即旧的slave)通信的</span></span><br><span class="line"><span class="comment"># 这个脚本应该是通用的，能被多次调用，不是针对性的。</span></span><br><span class="line"><span class="comment"># sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line"> sentinel client-reconfig-script mymaster /var/redis/reconfig.sh</span><br></pre></td></tr></table></figure>
<h1 id="Redis缓存穿透和雪崩"><a href="#Redis缓存穿透和雪崩" class="headerlink" title="Redis缓存穿透和雪崩"></a>Redis缓存穿透和雪崩</h1><p>Redis缓存的使用，极大的提升了应用程序的性能和效率，特别是数据查询方面。同时，他也带来了一些问题。其中，最要害的问题，就是数据的一致性问题，从严格意义上讲，这个问题无解。如果对数据的一致性要求很高，那么就不能使用缓存。</p>
<p>另外的一些典型问题就是，缓存穿透、缓存雪崩和缓存击穿。目前，业界也都比较流行的解决方案。</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E6%95%B0%E6%8D%AE%E5%BA%93%E6%9F%A5%E8%AF%A2.png" alt="数据库查询"></p>
<h2 id="缓存穿透（查不到）"><a href="#缓存穿透（查不到）" class="headerlink" title="缓存穿透（查不到）"></a>缓存穿透（查不到）</h2><blockquote>
<p>概念</p>
</blockquote>
<p>缓存穿透的概念很简单，用户想要查询一个数据，发现Redis内存数据库中没有，也就是缓存没有命中，于是向持久层数据库查询。发现也没有，于是本次查询失败。当用户很多的时候，缓存都没有命中（秒杀！），于是都去请求持久层数据库。这会给持久层数据库造成很大的压力，这时候就相当于出现了缓存穿透。</p>
<blockquote>
<p>解决方案</p>
</blockquote>
<p><strong>布隆过滤器</strong></p>
<p>布隆过滤器是一种数据结构，对所有可能查询的参数以hash形式存储，在控制层先进行校验，不符合则丢弃，从而避免了对底层存储系统的查询压力；</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E5%B8%83%E9%9A%86%E8%BF%87%E6%BB%A4%E5%99%A8.png" alt="布隆过滤器"></p>
<p><strong>缓存空对象</strong></p>
<p>当存储层不命中后，即时返回空对象也将其缓存起来，同时设置一个过期时间，之后再访问这个数据将会从缓存中获取，保护了后端数据源；</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%BC%93%E5%AD%98%E7%A9%BA%E5%AF%B9%E8%B1%A1.png" alt="缓存空对象"></p>
<p>但是这种方法会存在两个问题：</p>
<p>1、如果空值能够被缓存起来，这就意味着缓存需要更多的空间存储更多的键，因为这当中可能会有很多的空值的键；</p>
<p>2、即使对空值设置了过期时间，还是会存在缓存层和存储层的数据会有一段时间窗口的不一致，这对于需要保持一致性的业务也有影响。</p>
<h2 id="缓存击穿（查询量太大，缓存过期！）"><a href="#缓存击穿（查询量太大，缓存过期！）" class="headerlink" title="缓存击穿（查询量太大，缓存过期！）"></a>缓存击穿（查询量太大，缓存过期！）</h2><blockquote>
<p>概述</p>
</blockquote>
<p>这里需要注意和缓存击穿的区别，缓存击穿，是指一个key非常热点，在不停的扛着大并发，大并发集中对这个点进行访问，当这个key在失效的瞬间，持续的大并发就穿破缓存，直接请求数据库，就像在一个屏障上凿开了一个洞。</p>
<p>当某个key在过期的瞬间，有大量的请求并发访问，这类数据一般是热点数据，由于缓存过期，会同时访问数据库来查询最新数据，并且回写缓存，会导致数据库瞬间压力过大。</p>
<blockquote>
<p>解决方案</p>
</blockquote>
<p><strong>设置热点数据永不过期</strong></p>
<p>从缓存层面来看，没有设置过期时间，所以不会出现热点key过期后产生的问题。</p>
<p><strong>加互斥锁</strong></p>
<p>分布式锁：使用分布式锁，保证对于每个key同时只有一个线程去查询后端服务，其他线程没有获得分布式锁的权限，因此只需要等待即可。这个方式将高并发的压力转移到了分布式锁，因此对分布式锁的考验很大。</p>
<h2 id="缓存雪崩"><a href="#缓存雪崩" class="headerlink" title="缓存雪崩"></a>缓存雪崩</h2><blockquote>
<p>概念</p>
</blockquote>
<p>缓存雪崩，是指在某个时间段，缓存集中过期失效。Redis宕机！</p>
<p>产生雪崩的原因之一，比如在写文本的时候，马上就要到双十二零点，很快就会引来一波抢购，这波商品时间比较集中的放入了缓存，假设缓存一个小时。那么到了凌晨一点钟的时候，这批商品的缓存就都过期了。而对这批商品的访问查询，都落到了数据库上，对于数据库而言，就会产生周期性的压力波峰。于是所有的请求都会到达存储层，存储层的调用量会爆增，造成存储层也会挂掉的情况。</p>
<p><img src="/images/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/%E7%BC%93%E5%AD%98%E9%9B%AA%E5%B4%A9.png" alt="缓存雪崩"></p>
<p>其实集中过期，倒不是非常致命，比较致命的缓存雪崩，是缓存服务器某个节点宕机或断网。因为自然形成的缓存雪崩，一定是在某个时间段集中创建缓存，这个时候，数据库也是可以顶住压力的。无非就是对数据库产生周期性的压力而已。而缓存服务器节点的宕机，对数据库服务器造成的压力是不可预知的，很可能瞬间就把数据库压垮。</p>
<blockquote>
<p>解决方案</p>
</blockquote>
<p><strong>Redis高可用</strong></p>
<p>这个思想的含义是，既然Redis有可能挂掉，那我多增设几台Redis，这样一台挂掉了，其他的还可以继续工作，其实就是搭建集群。</p>
<p><strong>限流降级</strong>（在SpringCloud中有涉及）</p>
<p>这个解决方案的思想是，在缓存失效后，通过加锁或者队列来控制读数据库写缓存的线程量。比如对某个key只允许一个线程查询数据和写缓存，其他线程等待。</p>
<p><strong>数据预热</strong></p>
<p>数据加热的含义就是在正式部署之前，先把可能的数据预先访问一遍，这部分可能大量访问的数据就会加载在缓存中。在即将发生大并发访问前手动触发加载缓存不同的key，设置不同的过期时间，让缓存失效的时间点尽量均匀。</p>

    </div>

    <div>    
	    
    	  <div>    
	        
		<div style="text-align:center;color: #ccc;font-size:14px;">------------------------ The End ------------------------</div>    
	
</div>    
       
    </div>

    
    
    
      
  <div class="popular-posts-header">相关文章</div>
  <ul class="popular-posts">
    <li class="popular-posts-item">
      <div class="popular-posts-title"><a href="\2020\08\12\MyBatis学习笔记\" rel="bookmark">MyBatis学习笔记</a></div>
    </li>
  </ul>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>Light
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://light-alex.github.io/2020/08/26/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" title="Redis学习笔记">https://light-alex.github.io/2020/08/26/Redis学习笔记/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/" rel="tag"># 数据库</a>
              <a href="/tags/Redis/" rel="tag"># Redis</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/08/20/SpringBoot%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="prev" title="SpringBoot学习笔记">
      <i class="fa fa-chevron-left"></i> SpringBoot学习笔记
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/10/10/Ubuntu%E6%9B%B4%E6%8D%A2Python%E7%89%88%E6%9C%AC/" rel="next" title="Ubuntu更换Python版本">
      Ubuntu更换Python版本 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#什么是NoSQL"><span class="nav-number">1.</span> <span class="nav-text">什么是NoSQL</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#NoSQL特点"><span class="nav-number">2.</span> <span class="nav-text">NoSQL特点</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#数据存储"><span class="nav-number">3.</span> <span class="nav-text">数据存储</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#NoSQL的四大分类"><span class="nav-number">4.</span> <span class="nav-text">NoSQL的四大分类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis入门"><span class="nav-number">5.</span> <span class="nav-text">Redis入门</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#概述"><span class="nav-number">5.1.</span> <span class="nav-text">概述</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Windows安装"><span class="nav-number">5.2.</span> <span class="nav-text">Windows安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#下载压缩包："><span class="nav-number">5.2.1.</span> <span class="nav-text">下载压缩包：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#解压到电脑的环境目录下"><span class="nav-number">5.2.2.</span> <span class="nav-text">解压到电脑的环境目录下</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开启Redis，双击运行redis-server-exe"><span class="nav-number">5.2.3.</span> <span class="nav-text">开启Redis，双击运行redis-server.exe</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用redis客户端连接redis，打开redis-cli-exe"><span class="nav-number">5.2.4.</span> <span class="nav-text">使用redis客户端连接redis，打开redis-cli.exe</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#简单测试"><span class="nav-number">5.2.5.</span> <span class="nav-text">简单测试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Linux安装"><span class="nav-number">5.3.</span> <span class="nav-text">Linux安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#查看可用的-Redis-版本"><span class="nav-number">5.3.1.</span> <span class="nav-text">查看可用的 Redis 版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#取最新版的-Redis-镜像"><span class="nav-number">5.3.2.</span> <span class="nav-text">取最新版的 Redis 镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看本地镜像"><span class="nav-number">5.3.3.</span> <span class="nav-text">查看本地镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#运行容器，并做好端口映射"><span class="nav-number">5.3.4.</span> <span class="nav-text">运行容器，并做好端口映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装成功"><span class="nav-number">5.3.5.</span> <span class="nav-text">安装成功</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#进入容器"><span class="nav-number">5.3.6.</span> <span class="nav-text">进入容器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#设置root用户密码"><span class="nav-number">5.3.7.</span> <span class="nav-text">设置root用户密码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#更新apt"><span class="nav-number">5.3.8.</span> <span class="nav-text">更新apt</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装vim"><span class="nav-number">5.3.9.</span> <span class="nav-text">安装vim</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ssh-permission-denied问题解决"><span class="nav-number">5.3.10.</span> <span class="nav-text">ssh permission denied问题解决</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#安装SSH-server"><span class="nav-number">5.3.11.</span> <span class="nav-text">安装SSH server</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#启动SSH服务"><span class="nav-number">5.3.12.</span> <span class="nav-text">启动SSH服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用如下命令登陆本机"><span class="nav-number">5.3.13.</span> <span class="nav-text">使用如下命令登陆本机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#免密登录"><span class="nav-number">5.3.14.</span> <span class="nav-text">免密登录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#使用shereis命名查看redis安装目录"><span class="nav-number">5.3.15.</span> <span class="nav-text">使用shereis命名查看redis安装目录</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#创建自己的redis配置文件"><span class="nav-number">5.3.16.</span> <span class="nav-text">创建自己的redis配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#redis默认不是后台启动的，需要修改配置文件redis-conf"><span class="nav-number">5.3.17.</span> <span class="nav-text">redis默认不是后台启动的，需要修改配置文件redis.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#启动redis服务"><span class="nav-number">5.3.18.</span> <span class="nav-text">启动redis服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#测试redis"><span class="nav-number">5.3.19.</span> <span class="nav-text">测试redis</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看redis进程是否开启"><span class="nav-number">5.3.20.</span> <span class="nav-text">查看redis进程是否开启</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#如何关闭redis服务"><span class="nav-number">5.3.21.</span> <span class="nav-text">如何关闭redis服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#测试性能"><span class="nav-number">5.4.</span> <span class="nav-text">测试性能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#redis-cli"><span class="nav-number">5.5.</span> <span class="nav-text">redis-cli</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基础知识"><span class="nav-number">5.6.</span> <span class="nav-text">基础知识</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#五大基本数据类型"><span class="nav-number">6.</span> <span class="nav-text">五大基本数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Redis-Key"><span class="nav-number">6.1.</span> <span class="nav-text">Redis-Key</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#String（字符串）"><span class="nav-number">6.2.</span> <span class="nav-text">String（字符串）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#List"><span class="nav-number">6.3.</span> <span class="nav-text">List</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Set（集合）"><span class="nav-number">6.4.</span> <span class="nav-text">Set（集合）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hash-哈希"><span class="nav-number">6.5.</span> <span class="nav-text">Hash(哈希)</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Zset-有序集合"><span class="nav-number">6.6.</span> <span class="nav-text">Zset(有序集合)</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#三种特殊数据类型"><span class="nav-number">7.</span> <span class="nav-text">三种特殊数据类型</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#geospatial地址位置"><span class="nav-number">7.1.</span> <span class="nav-text">geospatial地址位置</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hyperloglog"><span class="nav-number">7.2.</span> <span class="nav-text">Hyperloglog</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Bitmaps"><span class="nav-number">7.3.</span> <span class="nav-text">Bitmaps</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#事务"><span class="nav-number">8.</span> <span class="nav-text">事务</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#监控"><span class="nav-number">9.</span> <span class="nav-text">监控</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Jedis"><span class="nav-number">10.</span> <span class="nav-text">Jedis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#什么是Jedis？"><span class="nav-number">10.1.</span> <span class="nav-text">什么是Jedis？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#用Jedis连接阿里云等服务器上的redis"><span class="nav-number">10.2.</span> <span class="nav-text">用Jedis连接阿里云等服务器上的redis</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#常用api"><span class="nav-number">10.3.</span> <span class="nav-text">常用api</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#SpringBoot整合"><span class="nav-number">11.</span> <span class="nav-text">SpringBoot整合</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis-conf详解"><span class="nav-number">12.</span> <span class="nav-text">Redis.conf详解</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis持久化"><span class="nav-number">13.</span> <span class="nav-text">Redis持久化</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#RDB（Redis-DataBase）"><span class="nav-number">13.1.</span> <span class="nav-text">RDB（Redis DataBase）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#AOF（Append-Only-File）"><span class="nav-number">14.</span> <span class="nav-text">AOF（Append Only File）</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis发布订阅"><span class="nav-number">15.</span> <span class="nav-text">Redis发布订阅</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis主从复制"><span class="nav-number">16.</span> <span class="nav-text">Redis主从复制</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#概念"><span class="nav-number">16.1.</span> <span class="nav-text">概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#环境配置"><span class="nav-number">16.2.</span> <span class="nav-text">环境配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#只配置从结点，不用配置主结点！"><span class="nav-number">16.2.1.</span> <span class="nav-text">只配置从结点，不用配置主结点！</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#复制三个配置文件，修改对应的信息"><span class="nav-number">16.2.2.</span> <span class="nav-text">复制三个配置文件，修改对应的信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#开三个终端启动对应的redis服务"><span class="nav-number">16.2.3.</span> <span class="nav-text">开三个终端启动对应的redis服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看redis进程"><span class="nav-number">16.2.4.</span> <span class="nav-text">查看redis进程</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#一主二从"><span class="nav-number">16.3.</span> <span class="nav-text">一主二从</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#哨兵模式"><span class="nav-number">17.</span> <span class="nav-text">哨兵模式</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Redis缓存穿透和雪崩"><span class="nav-number">18.</span> <span class="nav-text">Redis缓存穿透和雪崩</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#缓存穿透（查不到）"><span class="nav-number">18.1.</span> <span class="nav-text">缓存穿透（查不到）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缓存击穿（查询量太大，缓存过期！）"><span class="nav-number">18.2.</span> <span class="nav-text">缓存击穿（查询量太大，缓存过期！）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#缓存雪崩"><span class="nav-number">18.3.</span> <span class="nav-text">缓存雪崩</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Light"
      src="/images/header.png">
  <p class="site-author-name" itemprop="name">Light</p>
  <div class="site-description" itemprop="description">个人博客</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">17</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">20</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Light</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">310k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">4:42</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='120,120,120' opacity='0.5' zIndex='-1' count='150' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>


  <script defer src="/lib/three/three.min.js"></script>


  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  <script>
      window.addEventListener('load', () => {
      quicklink({
        timeout : 3000,
        priority: true,
        ignores : [uri => uri.includes('#'),uri => uri === 'https://light-alex.github.io/2020/08/26/Redis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/',]
      });
      });
  </script>

</body>
</html>
